<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¬Ø¹Ø¨Ù‡â€ŒØ§Ø¨Ø²Ø§Ø± Ø¨Ø§Ø²Ø§Ø±ÛŒØ§Ø¨ÛŒ | Marketing Toolkit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <!-- Fixed Lucide Script Source -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- New Dependencies for Strategy Validator -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Combined Google Fonts: Vazirmatn for Persian, Inter for English -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Vazirmatn:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f8fafc;
        }
        /* Style adjustments for LTR/RTL font switching in the new tool */
        html[lang="en"] body { 
            font-family: 'Inter', sans-serif; 
        }

        .gradient-text {
            background: linear-gradient(to right, #4f46e5, #9333ea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
        .tool-card {
            transition: all 0.3s ease;
        }
        .tool-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- New styles for Strategy Validator --- */
        .tab-active { border-bottom: 2px solid #2563eb; color: #2563eb; font-weight: 600; }
        .tab-inactive { color: #6b7280; font-weight: 400; }
        .tab-inactive:hover { color: #374151; }
        
        input[type="number"] { width: 100%; padding: 4px; border: 1px solid #d1d5db; border-radius: 4px; text-align: center; }
        input[type="number"]:focus { outline: none; border-color: #2563eb; ring: 2px; }
        
        th .subtitle { display: block; font-size: 0.75rem; color: #6b7280; font-weight: 400; margin-top: 2px; line-height: 1.1; }
        
        /* RTL Helper Overrides for Validator */
        html[dir="rtl"] .rounded-r { border-top-right-radius: 0; border-bottom-right-radius: 0; border-top-left-radius: 0.25rem; border-bottom-left-radius: 0.25rem; }
        html[dir="rtl"] .border-l-4 { border-left-width: 0; border-right-width: 4px; }
        html[dir="rtl"] .mr-1 { margin-left: 0.25rem; margin-right: 0; }
        html[dir="rtl"] .mr-2 { margin-left: 0.5rem; margin-right: 0; }
        html[dir="rtl"] .ml-4 { margin-right: 1rem; margin-left: 0; }
        html[dir="rtl"] .text-left { text-align: right; }

        /* Mobile Menu Styles */
        #mobile-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 40;
            transition: opacity 0.3s ease;
        }
        #mobile-menu-sidebar {
            position: fixed;
            top: 0;
            right: 0; /* Align right for RTL */
            width: 70%;
            max-width: 280px;
            height: 100%;
            background-color: #0f172a; /* Slate-900 */
            z-index: 50;
            transform: translateX(100%); /* Start off-screen right */
            transition: transform 0.3s ease;
        }
        #mobile-menu-overlay.open {
            opacity: 1;
        }
        #mobile-menu-sidebar.open {
            transform: translateX(0); /* Slide in */
        }
    </style>
</head>
<body class="text-slate-800 h-screen overflow-hidden flex">
    
    <!-- Mobile Menu Overlay and Sidebar (Hidden by default) -->
    <div id="mobile-menu-overlay" class="opacity-0 hidden" onclick="toggleMobileMenu()"></div>
    <aside id="mobile-menu-sidebar" class="md:hidden flex flex-col text-slate-300">
        <div class="p-6 border-b border-slate-800 flex items-center gap-3">
            <div class="bg-indigo-600 p-2 rounded-lg">
                <i data-lucide="layers" class="text-white w-6 h-6"></i>
            </div>
            <span class="font-bold text-white text-lg tracking-wide">Ù…Ø§Ø±Ú©ØªÛŒÙ†Ú¯â€ŒÙ¾ÙÙ„Ø§Ø³</span>
        </div>

        <nav class="flex-1 overflow-y-auto py-6 px-3 space-y-1" onclick="toggleMobileMenu()">
            <button onclick="showView('dashboard')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-800 transition-colors text-right group" id="nav-dashboard-mobile">
                <i data-lucide="layout-grid" class="w-5 h-5 group-hover:text-white"></i>
                <span class="font-medium group-hover:text-white">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§</span>
            </button>
            
            <div class="pt-4 pb-2 px-4 text-xs font-semibold text-slate-500 uppercase tracking-wider">Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯</div>
            
            <button onclick="showView('viral-tool')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-800 transition-all text-right" id="nav-viral-mobile">
                <i data-lucide="zap" class="w-5 h-5"></i>
                <span class="font-medium">Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ ÙˆØ§ÛŒØ±Ø§Ù„</span>
            </button>
            
            <button onclick="showView('strategy-validator')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-800 transition-colors text-right group" id="nav-strategy-mobile">
                <i data-lucide="bar-chart-3" class="w-5 h-5 group-hover:text-white"></i>
                <span class="font-medium group-hover:text-white">Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±</span>
            </button>

            <button class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-800 transition-colors text-right opacity-60 cursor-not-allowed group">
                <i data-lucide="pen-tool" class="w-5 h-5"></i>
                <span>Ú©Ù¾Ø´Ù†â€ŒÙ†ÙˆÛŒØ³ (Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ)</span>
                <i data-lucide="lock" class="w-3 h-3 mr-auto"></i>
            </button>
            
            <button class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-800 transition-colors text-right opacity-60 cursor-not-allowed group">
                <i data-lucide="hash" class="w-5 h-5"></i>
                <span>Ù‡Ø´ØªÚ¯ ÛŒØ§Ø¨ (Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ)</span>
                <i data-lucide="lock" class="w-3 h-3 mr-auto"></i>
            </button>
        </nav>

        <div class="p-4 border-t border-slate-800">
            <div class="flex items-center gap-3 p-2 rounded-lg bg-slate-800/50 border border-slate-700">
                <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-500 flex items-center justify-center text-white text-xs font-bold">
                    ME
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-white truncate">Ú©Ø§Ø±Ø¨Ø± Ù…Ù‡Ù…Ø§Ù†</p>
                    <p class="text-xs text-slate-500 truncate">Ø·Ø±Ø­ Ø±Ø§ÛŒÚ¯Ø§Ù†</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Sidebar (Desktop) -->
    <aside class="hidden md:flex flex-col w-64 bg-slate-900 text-slate-300 h-full flex-shrink-0">
        <div class="p-6 border-b border-slate-800 flex items-center gap-3">
            <div class="bg-indigo-600 p-2 rounded-lg">
                <i data-lucide="layers" class="text-white w-6 h-6"></i>
            </div>
            <span class="font-bold text-white text-lg tracking-wide">Ù…Ø§Ø±Ú©ØªÛŒÙ†Ú¯â€ŒÙ¾ÙÙ„Ø§Ø³</span>
        </div>

        <nav class="flex-1 overflow-y-auto py-6 px-3 space-y-1">
            <button onclick="showView('dashboard')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-800 transition-colors text-right group" id="nav-dashboard">
                <i data-lucide="layout-grid" class="w-5 h-5 group-hover:text-white"></i>
                <span class="font-medium group-hover:text-white">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§</span>
            </button>
            
            <div class="pt-4 pb-2 px-4 text-xs font-semibold text-slate-500 uppercase tracking-wider">Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯</div>
            
            <button onclick="showView('viral-tool')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl bg-indigo-600 text-white shadow-lg shadow-indigo-900/20 transition-all text-right" id="nav-viral">
                <i data-lucide="zap" class="w-5 h-5"></i>
                <span class="font-medium">Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ ÙˆØ§ÛŒØ±Ø§Ù„</span>
            </button>
            
            <!-- NEW TOOL NAVIGATION -->
            <button onclick="showView('strategy-validator')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-800 transition-colors text-right group" id="nav-strategy">
                <i data-lucide="bar-chart-3" class="w-5 h-5 group-hover:text-white"></i>
                <span class="font-medium group-hover:text-white">Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±</span>
            </button>

            <button class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-800 transition-colors text-right opacity-60 cursor-not-allowed group">
                <i data-lucide="pen-tool" class="w-5 h-5"></i>
                <span>Ú©Ù¾Ø´Ù†â€ŒÙ†ÙˆÛŒØ³ (Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ)</span>
                <i data-lucide="lock" class="w-3 h-3 mr-auto"></i>
            </button>
            
            <button class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-800 transition-colors text-right opacity-60 cursor-not-allowed group">
                <i data-lucide="hash" class="w-5 h-5"></i>
                <span>Ù‡Ø´ØªÚ¯ ÛŒØ§Ø¨ (Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ)</span>
                <i data-lucide="lock" class="w-3 h-3 mr-auto"></i>
            </button>
        </nav>

        <div class="p-4 border-t border-slate-800">
            <div class="flex items-center gap-3 p-2 rounded-lg bg-slate-800/50 border border-slate-700">
                <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-500 flex items-center justify-center text-white text-xs font-bold">
                    ME
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-white truncate">Ú©Ø§Ø±Ø¨Ø± Ù…Ù‡Ù…Ø§Ù†</p>
                    <p class="text-xs text-slate-500 truncate">Ø·Ø±Ø­ Ø±Ø§ÛŒÚ¯Ø§Ù†</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 h-full overflow-y-auto bg-slate-50 relative custom-scrollbar">
        <!-- Mobile Header -->
        <div class="md:hidden flex items-center justify-between p-4 bg-white border-b border-slate-200 sticky top-0 z-20">
            <div class="flex items-center gap-2">
                <div class="bg-indigo-600 p-1.5 rounded-lg">
                    <i data-lucide="layers" class="text-white w-5 h-5"></i>
                </div>
                <span class="font-bold text-slate-900">Ù…Ø§Ø±Ú©ØªÛŒÙ†Ú¯â€ŒÙ¾ÙÙ„Ø§Ø³</span>
            </div>
            <button onclick="toggleMobileMenu()" class="p-2 text-slate-600 hover:bg-slate-100 rounded-lg">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
        </div>

        <!-- VIEW 1: DASHBOARD (Hub) -->
        <div id="view-dashboard" class="p-6 md:p-10 max-w-7xl mx-auto fade-in">
            <header class="mb-10">
                <h1 class="text-3xl font-bold text-slate-900 mb-2">Ø³Ù„Ø§Ù…ØŒ Ø¨Ù‡ Ø¬Ø¹Ø¨Ù‡â€ŒØ§Ø¨Ø²Ø§Ø± Ø±Ø´Ø¯ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ ğŸ‘‹</h1>
                <p class="text-slate-500 text-lg">Ú©Ø¯Ø§Ù… Ø§Ø¨Ø²Ø§Ø± Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ú©Ù…Ù¾ÛŒÙ† Ø§Ù…Ø±ÙˆØ² Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ØŸ</p>
            </header>

            <!-- Tools Grid (Unified View) -->
            <h2 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2">
                <i data-lucide="grid" class="w-4 h-4"></i>
                Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ ÙØ¹Ø§Ù„ Ùˆ Ø¢ØªÛŒ
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <!-- Tool 1: Viral Strategy Maker (ACTIVE) - Non-Featured Style -->
                <div onclick="showView('viral-tool')" class="bg-white rounded-2xl p-6 border border-slate-200 tool-card cursor-pointer group hover:border-indigo-300">
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-12 h-12 rounded-xl bg-indigo-100 text-indigo-600 flex items-center justify-center">
                            <i data-lucide="zap" class="w-6 h-6"></i>
                        </div>
                        <span class="bg-indigo-100 text-indigo-700 text-xs px-2 py-1 rounded-lg font-bold">AI</span>
                    </div>
                    <h3 class="font-bold text-lg mb-1">Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ ÙˆØ§ÛŒØ±Ø§Ù„â€ŒÙ…ÛŒÚ©Ø±</h3>
                    <p class="text-sm text-slate-500">Ù…ÙˆØªÙˆØ± ØªÙˆÙ„ÛŒØ¯ Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ ØªØ¨Ù„ÛŒØºØ§ØªÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø±ÙˆØ§Ù†Ø´Ù†Ø§Ø³ÛŒ ÙØ±ÙˆØ´.</p>
                    <div class="mt-4 text-indigo-600 text-xs font-semibold flex items-center gap-1">
                        <i data-lucide="arrow-left" class="w-3 h-3"></i> Ø´Ø±ÙˆØ¹ Ú©Ø§Ø±
                    </div>
                </div>

                <!-- Tool 2: Business Idea Selector (ACTIVE) -->
                <div onclick="showView('strategy-validator')" class="bg-white rounded-2xl p-6 border border-slate-200 tool-card cursor-pointer group hover:border-blue-300">
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-12 h-12 rounded-xl bg-blue-100 text-blue-600 flex items-center justify-center">
                            <i data-lucide="bar-chart-3" class="w-6 h-6"></i>
                        </div>
                        <span class="bg-blue-100 text-blue-700 text-xs px-2 py-1 rounded-lg font-bold">Ø¬Ø¯ÛŒØ¯!</span>
                    </div>
                    <h3 class="font-bold text-lg mb-1">Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±</h3>
                    <p class="text-sm text-slate-500">ØªØ¬Ø²ÛŒÙ‡ Ùˆ ØªØ­Ù„ÛŒÙ„ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…ØªØ¯Ù‡Ø§ÛŒ ICE Ùˆ Weighted Matrix.</p>
                    <div class="mt-4 text-blue-600 text-xs font-semibold flex items-center gap-1">
                        <i data-lucide="arrow-left" class="w-3 h-3"></i> Ø´Ø±ÙˆØ¹ ØªØ­Ù„ÛŒÙ„
                    </div>
                </div>

                <!-- Tool 3: Caption Writer (Coming Soon) -->
                <div class="bg-white rounded-2xl p-6 border border-slate-200 opacity-60 grayscale hover:grayscale-0 hover:opacity-100 transition-all cursor-not-allowed">
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-12 h-12 rounded-xl bg-pink-100 text-pink-600 flex items-center justify-center">
                            <i data-lucide="pen-tool" class="w-6 h-6"></i>
                        </div>
                        <span class="bg-slate-100 text-slate-500 text-xs px-2 py-1 rounded-lg">Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ</span>
                    </div>
                    <h3 class="font-bold text-lg mb-1">Ú©Ù¾Ø´Ù†â€ŒÙ†ÙˆÛŒØ³ Ø¬Ø§Ø¯ÙˆÛŒÛŒ</h3>
                    <p class="text-sm text-slate-500">Ù†ÙˆØ´ØªÙ† Ú©Ù¾Ø´Ù†â€ŒÙ‡Ø§ÛŒ ØªØ¹Ø§Ù…Ù„ÛŒ Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù… Ø¯Ø± Û³ Ø«Ø§Ù†ÛŒÙ‡.</p>
                </div>

                <!-- Tool 4: Content Calendar (Coming Soon) -->
                <div class="bg-white rounded-2xl p-6 border border-slate-200 opacity-60 grayscale hover:grayscale-0 hover:opacity-100 transition-all cursor-not-allowed">
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-12 h-12 rounded-xl bg-green-100 text-green-600 flex items-center justify-center">
                            <i data-lucide="bar-chart-2" class="w-6 h-6"></i>
                        </div>
                        <span class="bg-slate-100 text-slate-500 text-xs px-2 py-1 rounded-lg">Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ</span>
                    </div>
                    <h3 class="font-bold text-lg mb-1">ØªÙ‚ÙˆÛŒÙ… Ù…Ø­ØªÙˆØ§ÛŒÛŒ</h3>
                    <p class="text-sm text-slate-500">Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Û³Û° Ø±ÙˆØ²Ù‡ Ø¨Ø±Ø§ÛŒ Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ.</p>
                </div>
            </div>
        </div>

        <!-- VIEW 2: VIRAL TOOL (The Application) -->
        <div id="view-viral-tool" class="hidden min-h-full flex flex-col fade-in">
            <!-- Tool Header -->
            <div class="bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between sticky top-0 z-10">
                <div class="flex items-center gap-3">
                    <button onclick="showView('dashboard')" class="md:hidden p-2 -mr-2 text-slate-500">
                        <i data-lucide="arrow-right"></i>
                    </button>
                    <div class="w-10 h-10 rounded-lg bg-indigo-100 text-indigo-600 flex items-center justify-center">
                        <i data-lucide="zap" class="w-5 h-5"></i>
                    </div>
                    <div>
                        <h2 class="font-bold text-slate-900">ÙˆØ§ÛŒØ±Ø§Ù„â€ŒÙ…ÙÛŒÚ©Ø±</h2>
                        <p class="text-xs text-slate-500">Ù…ÙˆØªÙˆØ± ØªÙˆÙ„ÛŒØ¯ Ø§ÛŒØ¯Ù‡ Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Û´ Ù…Ø¯Ù„ ØªØ¬Ø±Ø¨ÛŒ</p>
                    </div>
                </div>
                <button onclick="showView('dashboard')" class="hidden md:flex items-center gap-2 text-sm text-slate-500 hover:text-indigo-600 transition-colors">
                    <i data-lucide="layout-grid" class="w-4 h-4"></i>
                    Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
                </button>
            </div>

            <!-- Content Container -->
            <div class="flex-1 p-4 md:p-8 max-w-5xl mx-auto w-full">
                
                <!-- Educational Cards (Collapsible) -->
                <details class="group bg-white border border-slate-200 rounded-2xl mb-8 overflow-hidden">
                    <summary class="flex items-center justify-between p-4 cursor-pointer bg-slate-50 hover:bg-slate-100 transition-colors select-none">
                        <div class="flex items-center gap-2 font-bold text-slate-700">
                            <i data-lucide="book-open" class="w-5 h-5 text-indigo-500"></i>
                            <span>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù…Ø¯Ù„â€ŒÙ‡Ø§: Ú†Ú¯ÙˆÙ†Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø§ÛŒØ¯Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ØŸ</span>
                        </div>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-slate-400 group-open:rotate-180 transition-transform"></i>
                    </summary>
                    <div class="p-6 border-t border-slate-200">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <!-- Model 1 -->
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center shrink-0 text-sm font-bold">1</div>
                                <div>
                                    <h4 class="font-bold text-sm">Ø§Ø­ØªØ±Ø§Ù… VIP</h4>
                                    <p class="text-xs text-slate-500 mt-1">Ø§Ø±Ø³Ø§Ù„ Ø¯Ø¹ÙˆØªâ€ŒÙ†Ø§Ù…Ù‡ ÛŒØ§ Ù‡Ø¯ÛŒÙ‡ Ú©Ù‡ Ù…Ø®Ø§Ø·Ø¨ Ø¨Ø±Ø§ÛŒ Ù¾Ø² Ø¯Ø§Ø¯Ù† Ø§Ø³ØªÙˆØ±ÛŒ Ú©Ù†Ø¯.</p>
                                </div>
                            </div>
                            <!-- Model 2 -->
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center shrink-0 text-sm font-bold">2</div>
                                <div>
                                    <h4 class="font-bold text-sm">Ù…Ø´Ø§Ø±Ú©Øª Ø¬Ù…Ø¹ÛŒ</h4>
                                    <p class="text-xs text-slate-500 mt-1">Ù…Ø³Ø§Ø¨Ù‚Ø§ØªÛŒ Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯Ù†ØŒ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ ØªØ¨Ù„ÛŒØº Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</p>
                                </div>
                            </div>
                            <!-- Model 3 -->
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center shrink-0 text-sm font-bold">3</div>
                                <div>
                                    <h4 class="font-bold text-sm">Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¬Ù†Ø¬Ø§Ù„ÛŒ</h4>
                                    <p class="text-xs text-slate-500 mt-1">Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø´ÙØ§Ù Ø¨Ø§ Ø±Ù‚Ø¨Ø§ Ú©Ù‡ Ø¨Ø§Ø¹Ø« Ø¨Ø­Ø« Ùˆ Ø·Ø±ÙØ¯Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
                                </div>
                            </div>
                            <!-- Model 4 -->
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center shrink-0 text-sm font-bold">4</div>
                                <div>
                                    <h4 class="font-bold text-sm">ØªØ§Ø¨ÙˆØ´Ú©Ù†ÛŒ</h4>
                                    <p class="text-xs text-slate-500 mt-1">Ú¯ÙØªÙ† Ø­Ø±Ùâ€ŒÙ‡Ø§ÛŒ Ù…Ú¯Ùˆ (Ù…Ø«Ù„ Ù‚ÛŒÙ…Øª) Ú©Ù‡ Ø¯ÛŒÚ¯Ø±Ø§Ù† Ø¢Ù† Ø±Ø§ Ø¨Ø§Ø²Ù†Ø´Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯.</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-indigo-50 p-3 rounded-lg text-xs text-indigo-800 flex items-center gap-2">
                            <i data-lucide="info" class="w-4 h-4"></i>
                            Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø§ÛŒÙ† Ù…Ø¯Ù„â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§ <b>Ûµ Ù…Ø­Ø±Ú© Ø§Ø­Ø³Ø§Ø³ÛŒ (Ù‡ÙˆÛŒØªØŒ Ù„Ø°ØªØŒ Ù‚Ø¯Ø±ØªØŒ Ø§Ù…Ù†ÛŒØªØŒ Ø§Ø±Ø²Ø´)</b> ØªØ±Ú©ÛŒØ¨ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
                        </div>
                    </div>
                </details>

                <!-- Input Panel -->
                <div class="bg-white rounded-3xl shadow-sm border border-slate-200 p-6 md:p-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-2">Ø­ÙˆØ²Ù‡ Ú©Ø§Ø±ÛŒ Ø´Ù…Ø§</label>
                            <input type="text" id="businessInput" placeholder="Ù…Ø«Ø§Ù„: ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø´Ø§Ù„ØŒ Ú©Ø§ÙÙ‡..." class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all outline-none bg-slate-50 focus:bg-white">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-2">Ù…Ø®Ø§Ø·Ø¨ Ù‡Ø¯Ù</label>
                            <input type="text" id="customerInput" placeholder="Ù…Ø«Ø§Ù„: Ø®Ø§Ù†Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù†Ù‡â€ŒØ¯Ø§Ø±ØŒ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒØ§Ù†..." class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all outline-none bg-slate-50 focus:bg-white">
                        </div>
                    </div>

                    <div class="mb-8">
                        <label class="block text-sm font-bold text-slate-700 mb-2">Ù†ÙˆØ¹ Ù…Ø­ØªÙˆØ§</label>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3">
                            <label class="cursor-pointer">
                                <input type="radio" name="contentType" value="mixed" class="peer sr-only" checked>
                                <div class="p-3 rounded-xl border border-slate-200 peer-checked:border-indigo-500 peer-checked:bg-indigo-50 text-center transition-all h-full flex flex-col items-center justify-center gap-2 hover:bg-slate-50">
                                    <i data-lucide="wand-2" class="w-5 h-5 text-slate-400 peer-checked:text-indigo-600"></i>
                                    <span class="text-sm font-medium text-slate-600 peer-checked:text-indigo-800">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù‡ÙˆØ´Ù…Ù†Ø¯</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="contentType" value="stories" class="peer sr-only">
                                <div class="p-3 rounded-xl border border-slate-200 peer-checked:border-indigo-500 peer-checked:bg-indigo-50 text-center transition-all h-full flex flex-col items-center justify-center gap-2 hover:bg-slate-50">
                                    <i data-lucide="instagram" class="w-5 h-5 text-slate-400 peer-checked:text-indigo-600"></i>
                                    <span class="text-sm font-medium text-slate-600 peer-checked:text-indigo-800">Ø§Ø³ØªÙˆØ±ÛŒ/ÙˆØ§ØªØ³Ø§Ù¾</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="contentType" value="text_image" class="peer sr-only">
                                <div class="p-3 rounded-xl border border-slate-200 peer-checked:border-indigo-500 peer-checked:bg-indigo-50 text-center transition-all h-full flex flex-col items-center justify-center gap-2 hover:bg-slate-50">
                                    <i data-lucide="image" class="w-5 h-5 text-slate-400 peer-checked:text-indigo-600"></i>
                                    <span class="text-sm font-medium text-slate-600 peer-checked:text-indigo-800">Ù¾Ø³Øª Ø§Ø³Ù„Ø§ÛŒØ¯ÛŒ</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="contentType" value="simple_video" class="peer sr-only">
                                <div class="p-3 rounded-xl border border-slate-200 peer-checked:border-indigo-500 peer-checked:bg-indigo-50 text-center transition-all h-full flex flex-col items-center justify-center gap-2 hover:bg-slate-50">
                                    <i data-lucide="video" class="w-5 h-5 text-slate-400 peer-checked:text-indigo-600"></i>
                                    <span class="text-sm font-medium text-slate-600 peer-checked:text-indigo-800">ÙˆÛŒØ¯ÛŒÙˆ Ø³Ø§Ø¯Ù‡</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <button onclick="generatePrompt()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg shadow-indigo-500/30 flex justify-center items-center gap-2 text-lg">
                        <i data-lucide="sparkles"></i>
                        ØªÙˆÙ„ÛŒØ¯ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ
                    </button>
                </div>

                <!-- Result Area -->
                <div id="resultArea" class="hidden mt-8 animation-fade-in">
                    <div class="bg-slate-900 rounded-2xl overflow-hidden shadow-2xl ring-1 ring-white/10">
                        <div class="px-4 py-3 bg-slate-800/50 border-b border-white/5 flex justify-between items-center">
                            <span class="text-xs font-mono text-indigo-400 uppercase tracking-widest">AI Prompt Generated</span>
                            <button onclick="copyToClipboard()" class="flex items-center gap-2 text-xs text-slate-400 hover:text-white transition-colors bg-white/5 hover:bg-white/10 px-3 py-1.5 rounded-lg">
                                <i data-lucide="copy" class="w-3 h-3"></i>
                                <span id="copyText">Ú©Ù¾ÛŒ Ø¯Ø³ØªÙˆØ±</span>
                            </button>
                        </div>
                        <textarea id="promptOutput" readonly class="w-full h-80 bg-slate-900 text-slate-300 font-mono text-sm resize-none outline-none custom-scrollbar p-6 leading-relaxed"></textarea>
                    </div>
                    
                    <div class="mt-4 p-4 rounded-xl bg-gradient-to-r from-indigo-50 to-white border border-indigo-100 flex gap-4 shadow-sm">
                        <div class="bg-indigo-100 p-2 rounded-full h-fit text-indigo-600">
                            <i data-lucide="message-square" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-800 text-sm mb-1">Ù‚Ø¯Ù… Ø¨Ø¹Ø¯ÛŒ Ú†ÛŒØ³ØªØŸ</h4>
                            <p class="text-sm text-slate-600">Ù…ØªÙ† Ø¨Ø§Ù„Ø§ Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯ Ùˆ Ø¯Ø± Ú†Øªâ€ŒØ¨Ø§Øªâ€ŒÙ‡Ø§ÛŒÛŒ Ù…Ø«Ù„ <b>ChatGPT</b> ÛŒØ§ <b>Claude</b> Ø¨ÙØ±Ø³ØªÛŒØ¯. Ù†ØªÛŒØ¬Ù‡ ÛŒÚ© Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ú©Ø§Ù…Ù„ Ùˆ Ù…Ù‡Ù†Ø¯Ø³ÛŒ Ø´Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ø¯ Ø¨ÙˆØ¯.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW 3: STRATEGY VALIDATOR (New Tool) -->
        <div id="view-strategy-validator" class="hidden min-h-full flex flex-col fade-in">
            <div class="flex-1 max-w-7xl mx-auto w-full p-4 md:p-8">
                <!-- Content from the new tool, adapted to fit the main app's flow -->
                
                <div class="bg-white shadow-lg rounded-xl overflow-hidden flex flex-col mb-8">
                    
                    <!-- Header -->
                    <div class="bg-gray-900 text-white p-6 flex flex-col md:flex-row justify-between items-center gap-4">
                        <div class="text-center md:text-start">
                            <h1 class="text-2xl font-bold" data-i18n="app_title"><i class="fas fa-chess-board mr-2 rtl:ml-2"></i>Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±</h1>
                            <p class="text-gray-400 text-sm mt-1" data-i18n="app_subtitle">Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ICEØŒ Ù…Ø§ØªØ±ÛŒØ³ ÙˆØ²Ù†ÛŒ Ùˆ ØªØ­Ù„ÛŒÙ„ Ø±ÛŒØ³Ú©/Ù¾Ø§Ø¯Ø§Ø´ Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ Ú©Ù†ÛŒØ¯.</p>
                        </div>
                        
                        <div class="flex flex-col items-center md:items-end gap-3">
                            <!-- Lang Toggle -->
                            <div class="bg-gray-800 rounded-lg p-1 flex">
                                <button onclick="setLang('en')" id="btn-en" class="px-3 py-1 rounded text-xs font-bold text-gray-400 hover:text-white transition">English</button>
                                <button onclick="setLang('fa')" id="btn-fa" class="px-3 py-1 rounded text-xs font-bold bg-blue-600 text-white transition">ÙØ§Ø±Ø³ÛŒ</button>
                            </div>

                            <div class="flex gap-2">
                                <button onclick="addNewIdea()" class="hidden md:flex bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg transition text-sm font-medium items-center">
                                    <i class="fas fa-plus mr-1 rtl:ml-1"></i> <span data-i18n="btn_add">Ø§ÙØ²ÙˆØ¯Ù† Ø§ÛŒØ¯Ù‡</span>
                                </button>
                                <button onclick="window.print()" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition text-sm font-medium flex items-center">
                                    <i class="fas fa-print mr-1 rtl:ml-1"></i> <span data-i18n="btn_print">Ú†Ø§Ù¾ / PDF</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Tabs -->
                    <div class="flex flex-wrap border-b border-gray-200 px-6">
                        <button onclick="switchTab('ice')" id="tab-btn-ice" class="tab-active py-4 px-4 md:px-6 focus:outline-none text-sm md:text-base" data-i18n="tab_ice">
                            Û±. Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ ICE (Ú†Ø§Ø¨Ú©ÛŒ)
                        </button>
                        <button onclick="switchTab('weighted')" id="tab-btn-weighted" class="tab-inactive py-4 px-4 md:px-6 focus:outline-none text-sm md:text-base" data-i18n="tab_weighted">
                            Û². Ù…Ø§ØªØ±ÛŒØ³ ÙˆØ²Ù†ÛŒ (Ù…Ù†Ø·Ù‚)
                        </button>
                        <button onclick="switchTab('risk')" id="tab-btn-risk" class="tab-inactive py-4 px-4 md:px-6 focus:outline-none text-sm md:text-base" data-i18n="tab_risk">
                            Û³. Ø±ÛŒØ³Ú© Ùˆ Ù¾Ø§Ø¯Ø§Ø´ (Ø¨ØµØ±ÛŒ)
                        </button>
                    </div>

                    <!-- Content Area -->
                    <div class="p-6 flex-grow">
                        
                        <!-- TAB 1: ICE SCORING -->
                        <div id="tab-ice" class="block">
                            <!-- Explainer Box -->
                            <div class="bg-blue-50 border-l-4 rtl:border-r-4 border-blue-500 p-4 mb-6 rounded shadow-sm">
                                <h3 class="font-bold text-blue-800 text-sm mb-1">
                                    <i class="fas fa-info-circle mr-1 rtl:ml-1"></i> <span data-i18n="ice_explainer_title">Ú†Ú¯ÙˆÙ†Ù‡ ICE Ø±Ø§ Ø¯Ø±Ú© Ú©Ù†ÛŒÙ…</span>
                                </h3>
                                <p class="text-xs text-blue-700 leading-relaxed" data-i18n="ice_explainer_text">
                                    Ø§ÛŒÙ† Ø±ÙˆØ´ Ø¨Ù‡ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ "Ø¨Ø±Ø¯Ù‡Ø§ÛŒ Ø³Ø±ÛŒØ¹" Ú©Ù…Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ø³Ù‡ Ø¹Ø§Ù…Ù„ Ø±Ø§ Ø¶Ø±Ø¨ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.<br><strong>Ù‡Ø¯Ù:</strong> Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒÛŒ Ø¨Ø§ ØªØ£Ø«ÛŒØ± Ø¨Ø§Ù„Ø§ Ùˆ Ø§Ø¬Ø±Ø§ÛŒ Ø¢Ø³Ø§Ù† Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØ¯. <span class="font-bold">Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø§Ù„Ø§ØªØ± = Ø§ÛŒØ¯Ù‡ Ø¨Ù‡ØªØ±.</span>
                                </p>
                            </div>

                            <h2 class="text-xl font-semibold text-gray-800 mb-4" data-i18n="ice_header">Ø¬Ø¯ÙˆÙ„ Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ ICE</h2>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full text-left rtl:text-right border-collapse">
                                    <thead>
                                        <tr class="bg-gray-50 border-b align-top">
                                            <th class="p-3 w-1/4 align-middle" data-i18n="th_idea">Ø§ÛŒØ¯Ù‡ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±</th>
                                            <th class="p-3 text-center w-32">
                                                <span data-i18n="th_impact">ØªØ£Ø«ÛŒØ±</span>
                                                <span class="subtitle" data-i18n="sub_impact">Ø¯Ø±Ø¢Ù…Ø¯/Ù¾ÛŒØ±ÙˆØ²ÛŒ</span>
                                            </th>
                                            <th class="p-3 text-center w-32">
                                                <span data-i18n="th_confidence">Ø§Ø·Ù…ÛŒÙ†Ø§Ù†</span>
                                                <span class="subtitle" data-i18n="sub_confidence">Ù‚Ø·Ø¹ÛŒØª</span>
                                            </th>
                                            <th class="p-3 text-center w-32">
                                                <span data-i18n="th_ease">Ø³Ù‡ÙˆÙ„Øª</span>
                                                <span class="subtitle" data-i18n="sub_ease">Ø³Ø§Ø¯Ú¯ÛŒ Ø§Ø¬Ø±Ø§</span>
                                            </th>
                                            <th class="p-3 text-center w-32 bg-blue-50 font-bold border-l rtl:border-r rtl:border-l-0 align-middle">
                                                <span data-i18n="th_score">Ø§Ù…ØªÛŒØ§Ø² ICE</span>
                                                <span class="subtitle font-normal">I Ã— C Ã— E</span>
                                            </th>
                                            <th class="p-3 w-10 align-middle"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="ice-table-body">
                                        <!-- Rows generated by JS -->
                                    </tbody>
                                </table>
                            </div>

                            <div class="mt-8 h-64">
                                <canvas id="iceChart"></canvas>
                            </div>
                        </div>

                        <!-- TAB 2: WEIGHTED MATRIX -->
                        <div id="tab-weighted" class="hidden">
                            <!-- Explainer Box -->
                            <div class="bg-green-50 border-l-4 rtl:border-r-4 border-green-500 p-4 mb-6 rounded shadow-sm">
                                <h3 class="font-bold text-green-800 text-sm mb-1">
                                    <i class="fas fa-info-circle mr-1 rtl:ml-1"></i> <span data-i18n="weight_explainer_title">Ú†Ú¯ÙˆÙ†Ù‡ Ù…Ø§ØªØ±ÛŒØ³ ÙˆØ²Ù†ÛŒ Ø±Ø§ Ø¯Ø±Ú© Ú©Ù†ÛŒÙ…</span>
                                </h3>
                                <p class="text-xs text-green-700 leading-relaxed" data-i18n="weight_explainer_text">
                                    Ø§ÛŒÙ† Ø±ÙˆØ´ Ø¨Ø±Ø§ÛŒ "Ù…Ù†Ø·Ù‚" Ø§Ø³Øª. Ù‡Ù…Ù‡ Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§ Ø¨Ø±Ø§Ø¨Ø± Ù†ÛŒØ³ØªÙ†Ø¯. Ø¯Ø± Ø§ÛŒØ±Ø§Ù†ØŒ "ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒ" Ù…Ù…Ú©Ù† Ø§Ø³Øª Û² Ø¨Ø±Ø§Ø¨Ø± Ù…Ù‡Ù…â€ŒØªØ± Ø§Ø² "Ù…Ù‚ÛŒØ§Ø³â€ŒÙ¾Ø°ÛŒØ±ÛŒ" Ø¨Ø§Ø´Ø¯.<br><strong>Ù‡Ø¯Ù:</strong> Ø¯Ø±ØµØ¯Ù‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§ÙˆÙ„ÙˆÛŒØª Ø®ÙˆØ¯ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯.
                                </p>
                            </div>

                            <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-6 gap-4">
                                <div>
                                    <h2 class="text-xl font-semibold text-gray-800" data-i18n="weight_header">Ù…Ø§ØªØ±ÛŒØ³ ØªØµÙ…ÛŒÙ…â€ŒÚ¯ÛŒØ±ÛŒ ÙˆØ²Ù†ÛŒ</h2>
                                </div>
                                <!-- Weight Controls -->
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-xs w-full md:w-auto">
                                    <div class="bg-white p-2 rounded border border-green-200 shadow-sm">
                                        <label class="font-bold text-green-700" data-i18n="lbl_profit">Ø³ÙˆØ¯ Ùª</label>
                                        <input type="number" id="w1" value="30" onchange="updateWeights()" class="w-full mt-1">
                                    </div>
                                    <div class="bg-white p-2 rounded border border-red-200 shadow-sm">
                                        <label class="font-bold text-red-700" data-i18n="lbl_resilience">ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒ Ùª</label>
                                        <input type="number" id="w2" value="40" onchange="updateWeights()" class="w-full mt-1">
                                    </div>
                                    <div class="bg-white p-2 rounded border border-yellow-200 shadow-sm">
                                        <label class="font-bold text-yellow-700" data-i18n="lbl_speed">Ø³Ø±Ø¹Øª Ùª</label>
                                        <input type="number" id="w3" value="20" onchange="updateWeights()" class="w-full mt-1">
                                    </div>
                                    <div class="bg-white p-2 rounded border border-purple-200 shadow-sm">
                                        <label class="font-bold text-purple-700" data-i18n="lbl_scale">Ù…Ù‚ÛŒØ§Ø³ Ùª</label>
                                        <input type="number" id="w4" value="10" onchange="updateWeights()" class="w-full mt-1">
                                    </div>
                                </div>
                            </div>

                            <div class="overflow-x-auto">
                                <table class="w-full text-left rtl:text-right border-collapse">
                                    <thead>
                                        <tr class="bg-gray-50 border-b align-top">
                                            <th class="p-3 w-1/4 align-middle" data-i18n="th_idea">Ø§ÛŒØ¯Ù‡ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±</th>
                                            <th class="p-3 text-center">
                                                <span data-i18n="th_profit">Ø³ÙˆØ¯</span>
                                                <span class="subtitle" data-i18n="sub_profit">Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø§Ù„ÛŒ</span>
                                            </th>
                                            <th class="p-3 text-center">
                                                <span data-i18n="th_resilience">ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒ</span>
                                                <span class="subtitle" data-i18n="sub_resilience">Ø§Ù…Ù†ÛŒØª Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± ØªØ­Ø±ÛŒÙ…</span>
                                            </th>
                                            <th class="p-3 text-center">
                                                <span data-i18n="th_speed">Ø³Ø±Ø¹Øª</span>
                                                <span class="subtitle" data-i18n="sub_speed">Ø²Ù…Ø§Ù† Ø¹Ø±Ø¶Ù‡</span>
                                            </th>
                                            <th class="p-3 text-center">
                                                <span data-i18n="th_scale">Ù…Ù‚ÛŒØ§Ø³</span>
                                                <span class="subtitle" data-i18n="sub_scale">Ø±Ø´Ø¯</span>
                                            </th>
                                            <th class="p-3 text-center bg-gray-100 font-bold border-l rtl:border-r rtl:border-l-0 align-middle">
                                                <span data-i18n="th_total">Ù…Ø¬Ù…ÙˆØ¹</span>
                                                <span class="subtitle font-normal" data-i18n="sub_total">Ø§Ù…ØªÛŒØ§Ø² ÙˆØ²Ù†ÛŒ</span>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="weighted-table-body">
                                        <!-- Rows generated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- TAB 3: RISK VS REWARD -->
                        <div id="tab-risk" class="hidden">
                            <!-- Explainer Box -->
                            <div class="bg-purple-50 border-l-4 rtl:border-r-4 border-purple-500 p-4 mb-6 rounded shadow-sm">
                                <h3 class="font-bold text-purple-800 text-sm mb-1">
                                    <i class="fas fa-info-circle mr-1 rtl:ml-1"></i> <span data-i18n="risk_explainer_title">Ú†Ú¯ÙˆÙ†Ù‡ Ø±ÛŒØ³Ú© Ùˆ Ù¾Ø§Ø¯Ø§Ø´ Ø±Ø§ Ø¯Ø±Ú© Ú©Ù†ÛŒÙ…</span>
                                </h3>
                                <p class="text-xs text-purple-700 leading-relaxed" data-i18n="risk_explainer_text">
                                    Ø§ÛŒÙ† ÛŒÚ© Ù†Ù‚Ø´Ù‡ Ø¨ØµØ±ÛŒ Ø§Ø³Øª. Ø´Ù…Ø§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¯Ø± Ú¯ÙˆØ´Ù‡ Ø¨Ø§Ù„Ø§-Ú†Ù¾ (Ù¾Ø§Ø¯Ø§Ø´ Ø¨Ø§Ù„Ø§ØŒ Ø±ÛŒØ³Ú© Ú©Ù…) Ø¨Ø§Ø´ÛŒØ¯.<br><strong>Ø§Ø¬ØªÙ†Ø§Ø¨ Ú©Ù†ÛŒØ¯:</strong> Ø±ÛŒØ³Ú© Ø¨Ø§Ù„Ø§ Ø¨Ø§ Ù¾Ø§Ø¯Ø§Ø´ Ú©Ù… "ØªÙ„Ù‡ Ù…Ø±Ú¯" Ø§Ø³Øª.
                                </p>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="md:col-span-1 space-y-4">
                                    <div class="bg-white border border-gray-200 rounded-lg p-4 h-fit">
                                        <h3 class="font-bold text-gray-700 mb-3 border-b pb-2" data-i18n="risk_input_header">Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ</h3>
                                        <div id="risk-inputs" class="space-y-4">
                                            <!-- JS generates inputs here -->
                                        </div>
                                    </div>

                                    <!-- Legend -->
                                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                        <h4 class="font-bold text-gray-700 text-xs uppercase mb-2" data-i18n="legend_title">Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù†ÙˆØ§Ø­ÛŒ</h4>
                                        <ul class="space-y-2 text-xs">
                                            <li class="flex items-center"><span class="w-3 h-3 bg-green-500 rounded-full mr-2 rtl:ml-2 rtl:mr-0"></span> <strong data-i18n="leg_gold">Ø¨Ø§Ù„Ø§-Ú†Ù¾: Ù†Ø§Ø­ÛŒÙ‡ Ø·Ù„Ø§ÛŒÛŒ (Ø¨Ù‡ØªØ±ÛŒÙ†)</strong></li>
                                            <li class="flex items-center"><span class="w-3 h-3 bg-yellow-500 rounded-full mr-2 rtl:ml-2 rtl:mr-0"></span> <strong data-i18n="leg_moon">Ø¨Ø§Ù„Ø§-Ø±Ø§Ø³Øª: Ù¾Ø±ØªØ§Ø¨ Ø¨Ù‡ Ù…Ø§Ù‡ (Ø±ÛŒØ³Ú© Ø¨Ø§Ù„Ø§)</strong></li>
                                            <li class="flex items-center"><span class="w-3 h-3 bg-blue-400 rounded-full mr-2 rtl:ml-2 rtl:mr-0"></span> <strong data-i18n="leg_safe">Ù¾Ø§ÛŒÛŒÙ†-Ú†Ù¾: Ø´Ø±Ø·â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ù†</strong></li>
                                            <li class="flex items-center"><span class="w-3 h-3 bg-red-500 rounded-full mr-2 rtl:ml-2 rtl:mr-0"></span> <strong data-i18n="leg_death">Ù¾Ø§ÛŒÛŒÙ†-Ø±Ø§Ø³Øª: ØªÙ„Ù‡ Ù…Ø±Ú¯ (Ø§Ø¬ØªÙ†Ø§Ø¨ Ú©Ù†ÛŒØ¯)</strong></li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="md:col-span-2 bg-white border border-gray-200 rounded-lg p-4 relative min-h-[400px]">
                                    <canvas id="riskChart"></canvas>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                
            </div>
        </div>
        
        <!-- Floating Action Button for Strategy Validator -->
        <!-- Fixed button visible only when the validator view is active. -->
        <button id="floating-add-btn" 
                onclick="addNewIdea()" 
                class="fixed bottom-6 right-6 
                       bg-blue-600 hover:bg-blue-500 text-white 
                       px-6 py-4 rounded-full shadow-2xl shadow-blue-500/50 
                       transition-all duration-300 text-lg font-bold flex items-center gap-2 z-30 
                       opacity-0 pointer-events-none">
            <i class="fas fa-plus"></i>
            <span data-i18n="btn_add_float">Ø§ÙØ²ÙˆØ¯Ù† Ø§ÛŒØ¯Ù‡ Ø¬Ø¯ÛŒØ¯</span>
        </button>
    </main>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        
        // --- Firebase Setup Placeholder ---
        // (Note: This is present for environment compatibility but actual Firebase/Auth usage is currently minimal in this file)
        /*
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, auth;

        async function setupFirebase() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    console.warn("Firebase config not found. Running in local mode.");
                    return;
                }
                
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                    console.log("Firebase signed in with custom token.");
                } else {
                    await signInAnonymously(auth);
                    console.log("Firebase signed in anonymously.");
                }
                window.firebaseAuth = auth; 
            } catch (error) {
                console.error("Firebase setup failed:", error);
            }
        }
        setupFirebase();
        */
        // --- End Firebase Setup Placeholder ---
        
        // Check if Lucide is loaded, if not, wait for it
        function initIcons() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            } else {
                // If not loaded yet, retry after 100ms
                setTimeout(initIcons, 100);
            }
        }
        
        // --- Mobile Menu Fix: Added toggleMobileMenu function ---
        function toggleMobileMenu() {
            const sidebar = document.getElementById('mobile-menu-sidebar');
            const overlay = document.getElementById('mobile-menu-overlay');

            // Toggle visibility (using hidden class for the overlay)
            if (sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
                overlay.classList.remove('open');
                // Wait for transition to finish before hiding display
                setTimeout(() => { overlay.classList.add('hidden'); }, 300);
            } else {
                overlay.classList.remove('hidden');
                setTimeout(() => { // Force reflow to ensure transition runs
                    sidebar.classList.add('open');
                    overlay.classList.add('open');
                }, 10);
            }

            // Re-create lucide icons inside the mobile menu after opening/closing
            initIcons();
        }


        // Start checking when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
             initIcons();
             showView('dashboard'); // Default view
             setLang('fa'); // Initialize validator in default lang
             // Render validator content only if active, otherwise it will render when view is shown
        });

        // --- View Navigation Logic ---
        function showView(viewName) {
            const views = {
                'dashboard': document.getElementById('view-dashboard'),
                'viral-tool': document.getElementById('view-viral-tool'),
                'strategy-validator': document.getElementById('view-strategy-validator')
            };
            const navs = {
                'dashboard': document.getElementById('nav-dashboard'),
                'viral-tool': document.getElementById('nav-viral'),
                'strategy-validator': document.getElementById('nav-strategy')
            };
            // Mobile Navs (for state synchronization)
            const mobileNavs = {
                'dashboard': document.getElementById('nav-dashboard-mobile'),
                'viral-tool': document.getElementById('nav-viral-mobile'),
                'strategy-validator': document.getElementById('nav-strategy-mobile')
            };


            // Floating Button Visibility Toggle
            const floatingBtn = document.getElementById('floating-add-btn');

            // Deactivate all
            Object.keys(views).forEach(key => {
                views[key].classList.add('hidden');
                
                // Desktop navs
                if (navs[key]) {
                    navs[key].classList.remove('bg-indigo-600', 'text-white', 'shadow-lg', 'shadow-indigo-900/20');
                    navs[key].classList.add('hover:bg-slate-800');
                }
                // Mobile navs
                if (mobileNavs[key]) {
                    mobileNavs[key].classList.remove('bg-indigo-600', 'text-white', 'shadow-lg', 'shadow-indigo-900/20');
                    mobileNavs[key].classList.add('hover:bg-slate-800');
                }
            });

            // Activate selected view
            if (views[viewName]) {
                views[viewName].classList.remove('hidden');
                
                // Desktop navs
                if (navs[viewName]) {
                    navs[viewName].classList.add('bg-indigo-600', 'text-white', 'shadow-lg', 'shadow-indigo-900/20');
                    navs[viewName].classList.remove('hover:bg-slate-800');
                }
                // Mobile navs
                 if (mobileNavs[viewName]) {
                    mobileNavs[viewName].classList.add('bg-indigo-600', 'text-white', 'shadow-lg', 'shadow-indigo-900/20');
                    mobileNavs[viewName].classList.remove('hover:bg-slate-800');
                }
                
                if (viewName === 'strategy-validator') {
                     // Show floating button
                    floatingBtn.classList.remove('opacity-0', 'pointer-events-none');
                    floatingBtn.classList.add('opacity-100');
                     // Ensure the new tool is initialized and rendered
                     if (typeof renderAll === 'function') {
                        renderAll();
                     }
                } else {
                    // Hide floating button for other views
                    floatingBtn.classList.remove('opacity-100');
                    floatingBtn.classList.add('opacity-0', 'pointer-events-none');
                }
            } else {
                // Hide floating button if no view is selected or unknown view
                floatingBtn.classList.remove('opacity-100');
                floatingBtn.classList.add('opacity-0', 'pointer-events-none');
            }
        }

        // --- Viral Tool Prompt Generation Logic (Existing Code) ---
        function generatePrompt() {
            const business = document.getElementById('businessInput').value.trim();
            const customer = document.getElementById('customerInput').value.trim();
            const contentType = document.querySelector('input[name="contentType"]:checked').value;
            
            // NOTE: Replaced alert() with console.error as per instructions.
            if (!business || !customer) {
                console.error('Ù„Ø·ÙØ§Ù‹ Ø­ÙˆØ²Ù‡ Ú©Ø§Ø±ÛŒ Ùˆ Ù…Ø´Ø®ØµØ§Øª Ù…Ø´ØªØ±ÛŒØ§Ù† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
                // Placeholder for custom modal or message box UI
                return;
            }

            let formatInstruction = "";
            
            if (contentType === 'stories') {
                formatInstruction = `
**Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ÙØ±Ù…Øª Ù…Ø­ØªÙˆØ§:**
Ù„Ø·ÙØ§Ù‹ Ø§ÛŒØ¯Ù‡ ÙÙ‚Ø· Ù…Ù†Ø§Ø³Ø¨ **Ø§Ø³ØªÙˆØ±ÛŒ Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…** ÛŒØ§ **ÙˆØ¶Ø¹ÛŒØª ÙˆØ§ØªØ³Ø§Ù¾** Ø¨Ø§Ø´Ø¯.
- Ø§Ø² Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ÛŒ Ù¾ÛŒÚ†ÛŒØ¯Ù‡ Ø®ÙˆØ¯Ø¯Ø§Ø±ÛŒ Ú©Ù†.
- Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ¹Ø§Ù…Ù„ÛŒ (Ù…Ø«Ù„ Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒØŒ Ø¨Ø§Ú©Ø³ Ø³ÙˆØ§Ù„) Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø¯Ù‡.
`;
            } else if (contentType === 'text_image') {
                formatInstruction = `
**Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ÙØ±Ù…Øª Ù…Ø­ØªÙˆØ§:**
Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· Ø§ÛŒØ¯Ù‡ Ø¨Ø±Ø§ÛŒ **Ù¾Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø³Ù„Ø§ÛŒØ¯ÛŒ (Carousel)** ÛŒØ§ **Ù…ØªÙ†ÛŒ (ØªÙˆÛŒÛŒØªâ€ŒØ·ÙˆØ±)** Ø¨Ø§Ø´Ø¯.
- Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ ÙˆÛŒØ¯ÛŒÙˆ.
- ØªÙ…Ø±Ú©Ø² Ø±ÙˆÛŒ ØªÛŒØªØ± Ùˆ Ù…ØªÙ† Ø¬Ø°Ø§Ø¨.
`;
            } else if (contentType === 'simple_video') {
                formatInstruction = `
**Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ÙØ±Ù…Øª Ù…Ø­ØªÙˆØ§:**
Ù„Ø·ÙØ§Ù‹ Ø§ÛŒØ¯Ù‡ Ø¨Ø±Ø§ÛŒ **ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡ Ùˆ Ø±Ø¦Ø§Ù„** Ø¨Ø§Ø´Ø¯.
- ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ÛŒ Ø³Ù„ÙÛŒ ÛŒØ§ Ù¾Ø´Øªâ€ŒØµØ­Ù†Ù‡ Ø³Ø§Ø¯Ù‡.
- Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§Ø¯ÛŒØª Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ.
`;
            } else {
                formatInstruction = `
**Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ÙØ±Ù…Øª Ù…Ø­ØªÙˆØ§:**
Ú†ÙˆÙ† Ù…Ù† ÛŒÚ© Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø± Ú©ÙˆÚ†Ú© Ù‡Ø³ØªÙ…ØŒ Ø§ÛŒØ¯Ù‡â€ŒØ§ÛŒ Ø¨Ø¯Ù‡ Ú©Ù‡ **Ø§Ø¬Ø±Ø§ÛŒ Ø¢Ù† Ú©Ù…â€ŒÙ‡Ø²ÛŒÙ†Ù‡ Ùˆ Ø±Ø§Ø­Øª** Ø¨Ø§Ø´Ø¯.
`;
            }

            // The Prompt Template
            const promptTemplate = `
**Ù†Ù‚Ø´:** ØªÙˆ ÛŒÚ© Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒØ³Øª Ø§Ø±Ø´Ø¯ Ø¨Ø§Ø²Ø§Ø±ÛŒØ§Ø¨ÛŒ ÙˆÛŒØ±ÙˆØ³ÛŒ Ù‡Ø³ØªÛŒ Ú©Ù‡ ØªØ®ØµØµØª ØªØ±Ú©ÛŒØ¨ Â«ØªØ¬Ø±Ø¨ÛŒØ§Øª ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø§Ø²Ø§Ø± Ø§ÛŒØ±Ø§Ù†Â» Ø¨Ø§ Â«Ø±ÙˆØ§Ù†Ø´Ù†Ø§Ø³ÛŒ ÙØ±ÙˆØ´Â» (Neuromarketing) Ø§Ø³Øª.

**Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ±ÙˆØ¯ÛŒ Ù…Ù†:**
Ù…Ù† ØµØ§Ø­Ø¨ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±ÛŒ Ø¯Ø± Ø²Ù…ÛŒÙ†Ù‡: **${business}** Ù‡Ø³ØªÙ….
Ù…Ø´ØªØ±ÛŒØ§Ù† Ù‡Ø¯Ù Ù…Ù† Ø¹Ø¨Ø§Ø±ØªÙ†Ø¯ Ø§Ø²: **${customer}**

**Ù…Ø§Ù…ÙˆØ±ÛŒØª ØªÙˆ:**
Ø¨Ø§ÛŒØ¯ **Û± Ø§ÛŒØ¯Ù‡ Ø§Ø¬Ø±Ø§ÛŒÛŒ Ùˆ Ø®Ù„Ø§Ù‚Ø§Ù†Ù‡** (Ø¨Ù‡ØªØ±ÛŒÙ† Ùˆ Ù…ÙˆØ«Ø±ØªØ±ÛŒÙ† Ø§ÛŒØ¯Ù‡ Ù…Ù…Ú©Ù†) Ø¨Ø±Ø§ÛŒ ÙˆØ§ÛŒØ±Ø§Ù„ Ø´Ø¯Ù† Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±Ù‡Ø§ÛŒ Ù…Ù† Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¯Ù‡ÛŒ.
Ù†Ú©ØªÙ‡ Ø­ÛŒØ§ØªÛŒ: Ø§ÛŒÙ† Ø§ÛŒØ¯Ù‡ Ø¨Ø§ÛŒØ¯ ØªØ±Ú©ÛŒØ¨ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯Ø§Ù†Ù‡ Ø§Ø² ÛŒÚ©ÛŒ Ø§Ø² **Â«Û´ Ù…Ø¯Ù„ ØªØ¬Ø±Ø¨ÛŒ ÙˆØ§ÛŒØ±Ø§Ù„Â»** (Ø±ÙˆØ´ Ø§Ø¬Ø±Ø§) Ùˆ ÛŒÚ©ÛŒ Ø§Ø² **Â«Ûµ Ù…Ø­Ø±Ú© Ø§Ø­Ø³Ø§Ø³ÛŒÂ»** (Ø±ÙˆØ§Ù†Ø´Ù†Ø§Ø³ÛŒ) Ø¨Ø§Ø´Ø¯ Ú©Ù‡ Ø¯Ø± Ø²ÛŒØ± ØªÙˆØ¶ÛŒØ­ Ø¯Ø§Ø¯Ù‡â€ŒØ§Ù….

${formatInstruction}

---

### Ø¨Ø®Ø´ Ø§ÙˆÙ„: Û´ Ù…Ø¯Ù„ ØªØ¬Ø±Ø¨ÛŒ ÙˆØ§ÛŒØ±Ø§Ù„ (Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ø§Ø«Ø¨Ø§Øª Ø´Ø¯Ù‡ Ø¯Ø± Ø§ÛŒØ±Ø§Ù†)
Ø§ÛŒÙ†â€ŒÙ‡Ø§ Û´ ØªØ¬Ø±Ø¨Ù‡â€ŒÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ù‡Ø³ØªÙ†Ø¯ Ú©Ù‡ Ø¯Ø± Ø¨Ø§Ø²Ø§Ø± Ø§ÛŒØ±Ø§Ù† ØªØ³Øª Ø´Ø¯Ù‡ Ùˆ Ø¬ÙˆØ§Ø¨ Ø¯Ø§Ø¯Ù‡â€ŒØ§Ù†Ø¯. Ø§ÛŒØ¯Ù‡ ØªÙˆ Ø¨Ø§ÛŒØ¯ Ø¨Ø± Ø§Ø³Ø§Ø³ ÛŒÚ©ÛŒ Ø§Ø² Ø§ÛŒÙ† Ù…Ú©Ø§Ù†ÛŒØ²Ù…â€ŒÙ‡Ø§ Ø¨Ø§Ø´Ø¯:

1.  **Ù…Ø¯Ù„ Â«Ø§Ø­ØªØ±Ø§Ù… Ùˆ Ø§Ø¹ØªØ¨Ø§Ø± VIPÂ» (ØªØ¬Ø±Ø¨Ù‡ Ú©Ø§Ø±Øª Ø¯Ø¹ÙˆØª):**
    * *Ù…Ú©Ø§Ù†ÛŒØ²Ù…:* Ø§Ø±Ø³Ø§Ù„ ÛŒÚ© Ø¯Ø¹ÙˆØªâ€ŒÙ†Ø§Ù…Ù‡ØŒ Ù‡Ø¯ÛŒÙ‡ ÛŒØ§ Ù¾ÛŒØ§Ù… Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ø®Ø§Ø·Ø¨.
    * *Ú†Ø±Ø§ÛŒÛŒ ÙˆØ§ÛŒØ±Ø§Ù„:* Ù…Ø®Ø§Ø·Ø¨ Ø¨Ø±Ø§ÛŒ Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù† Ù¾Ø±Ø³ØªÛŒÚ˜ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ Ùˆ ØªØ´Ú©Ø± Ø§Ø² Ø§Ø­ØªØ±Ø§Ù… Ø´Ù…Ø§ØŒ Ø¢Ù† Ø±Ø§ Ø§Ø³ØªÙˆØ±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
2.  **Ù…Ø¯Ù„ Â«Ù…Ø´Ø§Ø±Ú©Øª Ø¬Ù…Ø¹ÛŒ Ùˆ Ù…Ø³Ø§Ø¨Ù‚Ù‡Â» (ØªØ¬Ø±Ø¨Ù‡ Ø±Ø£ÛŒâ€ŒÚ¯ÛŒØ±ÛŒ):**
    * *Ù…Ú©Ø§Ù†ÛŒØ²Ù…:* Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ Ù…Ø³Ø§Ø¨Ù‚Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø¨Ø±Ù†Ø¯Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ "ØªØ¹Ø¯Ø§Ø¯ Ù„Ø§ÛŒÚ© ÛŒØ§ Ú©Ø§Ù…Ù†Øª" Ù…Ø´Ø®Øµ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
    * *Ú†Ø±Ø§ÛŒÛŒ ÙˆØ§ÛŒØ±Ø§Ù„:* Ø´Ø±Ú©Øªâ€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯Ù†ØŒ Ø®ÙˆØ¯Ø´ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø±Ø³Ø§Ù†Ù‡ Ø´Ù…Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø§Ø² ØªÙ…Ø§Ù… Ø¯ÙˆØ³ØªØ§Ù†Ø´ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ø¯ Ú©Ù‡ Ø±Ø£ÛŒ Ø¯Ù‡Ù†Ø¯.
3.  **Ù…Ø¯Ù„ Â«Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¬Ù†Ø¬Ø§Ù„ÛŒ Ùˆ Ø´ÙØ§ÙÂ» (ØªØ¬Ø±Ø¨Ù‡ Ø®Ø§Ù†Ú¯ÛŒ vs ØµÙ†Ø¹ØªÛŒ):**
    * *Ù…Ú©Ø§Ù†ÛŒØ²Ù…:* Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¨ÛŒâ€ŒØ±Ø­Ù…Ø§Ù†Ù‡ Ùˆ ØµØ§Ø¯Ù‚Ø§Ù†Ù‡ Ù…Ø­ØµÙˆÙ„ Ø®ÙˆØ¯ Ø¨Ø§ Ø±Ù‚Ø¨Ø§ÛŒ Ø¨Ø²Ø±Ú¯/ØµÙ†Ø¹ØªÛŒ Ùˆ Ø¨ÛŒØ§Ù† Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù Ùˆ Ù‚ÙˆØª.
    * *Ú†Ø±Ø§ÛŒÛŒ ÙˆØ§ÛŒØ±Ø§Ù„:* Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø­Ø« Ùˆ Ø¬Ø¯Ù„ Ø¨ÛŒÙ† Ø·Ø±ÙØ¯Ø§Ø±Ø§Ù† Ø¯Ùˆ Ú¯Ø±ÙˆÙ‡ Ùˆ Ø­Ù…Ø§ÛŒØª Ù…ØªØ¹ØµØ¨Ø§Ù†Ù‡ Ù‚Ø´Ø± Ø®Ø§Øµ.
4.  **Ù…Ø¯Ù„ Â«ØªØ§Ø¨ÙˆØ´Ú©Ù†ÛŒ Ùˆ Ø²Ø¨Ø§Ù† Ù…Ø´ØªØ±Ú©Â» (ØªØ¬Ø±Ø¨Ù‡ Ù„ÛŒØ³Øª Ù‚ÛŒÙ…Øª):**
    * *Ù…Ú©Ø§Ù†ÛŒØ²Ù…:* Ø¨ÛŒØ§Ù† Ø´ÙØ§Ù Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ Ú©Ù‡ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ù…Ø®ÙÛŒ Ø§Ø³Øª (Ù…Ø«Ù„ Ù‚ÛŒÙ…Øª ØªÙ…Ø§Ù… Ø´Ø¯Ù‡) ÛŒØ§ Ø­Ø±ÙÛŒ Ú©Ù‡ Ø¯ÛŒÚ¯Ø±Ø§Ù† Ù…ÛŒâ€ŒØªØ±Ø³Ù†Ø¯ Ø¨Ø²Ù†Ù†Ø¯.
    * *Ú†Ø±Ø§ÛŒÛŒ ÙˆØ§ÛŒØ±Ø§Ù„:* Ú©Ø³Ø§Ù†ÛŒ Ú©Ù‡ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø§ÛŒÙ† Ø­Ø±Ùâ€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø²Ù†Ù†Ø¯ØŒ Ù…Ø­ØªÙˆØ§ÛŒ Ø´Ù…Ø§ Ø±Ø§ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† "Ø­Ø±Ù Ø¯Ù„" Ø®ÙˆØ¯Ø´Ø§Ù† Ø§Ø³ØªÙˆØ±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯.

### Ø¨Ø®Ø´ Ø¯ÙˆÙ…: Ûµ Ù…Ø­Ø±Ú© Ø§Ø­Ø³Ø§Ø³ÛŒ Ø®Ø±ÛŒØ¯ (Ø±ÙˆØ§Ù†Ø´Ù†Ø§Ø³ÛŒ Ù†ÙÙˆØ°)
Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù…Ø®Ø§Ø·Ø¨ Ø¯Ú©Ù…Ù‡ Share Ø±Ø§ Ø¨Ø²Ù†Ø¯ØŒ Ø¨Ø§ÛŒØ¯ ÛŒÚ©ÛŒ Ø§Ø² Ø­Ø³â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± ØªØ­Ø±ÛŒÚ© Ø´ÙˆØ¯:
1.  **Ø­Ø³ ØªØ¹Ù„Ù‚ Ùˆ Ù‡ÙˆÛŒØª (Identity):** Ù…Ø­ØµÙˆÙ„ Ù†Ø´Ø§Ù†â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ Ùˆ Ú©Ù„Ø§Ø³ Ù…Ø®Ø§Ø·Ø¨ Ø¨Ø§Ø´Ø¯ ("Ø§ÛŒÙ† Ù…Ù†Ù…!").
2.  **Ø­Ø³ Ù„Ø°Øª Ùˆ ØªØ¬Ø±Ø¨Ù‡ (Pleasure):** ØªÙ…Ø±Ú©Ø² Ø¨Ø± Ø­Ø³ Ø®ÙˆØ¨ØŒ Ø²ÛŒØ¨Ø§ÛŒÛŒ Ùˆ Ù„Ø°Øª Ø®Ø§Ù„Øµ.
3.  **Ø­Ø³ Ù‚Ø¯Ø±Øª Ùˆ Ú©Ù†ØªØ±Ù„ (Power):** Ù…Ø®Ø§Ø·Ø¨ Ø­Ø³ Ú©Ù†Ø¯ Ø¨Ø§ Ø§ÛŒÙ† Ø§ÛŒØ¯Ù‡ØŒ Ù‚Ø¯Ø±Øª Ù…Ø¯ÛŒØ±ÛŒØª Ùˆ Ø§Ø¹ØªÙ…Ø§Ø¯Ø¨Ù‡â€ŒÙ†ÙØ³ Ø¨Ø§Ù„Ø§ØªØ±ÛŒ Ø¯Ø§Ø±Ø¯.
4.  **Ø­Ø³ Ø§Ù…Ù†ÛŒØª Ùˆ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† (Certainty):** Ø±ÙØ¹ ØªØ±Ø³â€ŒÙ‡Ø§ Ùˆ Ø§ÛŒÙØ§ÛŒ Ù†Ù‚Ø´ "Ù†Ø§Ø¬ÛŒ" ÛŒØ§ "Ù…Ø´Ø§ÙˆØ± Ø¯Ù„Ø³ÙˆØ²".
5.  **Ø­Ø³ Ø§Ø±Ø²Ø´Ù…Ù†Ø¯ÛŒ Ùˆ Ø§Ø­ØªØ±Ø§Ù… (Valued):** Ø­Ø³ VIP Ø¨ÙˆØ¯Ù† Ùˆ Ø§ÛŒÙ†Ú©Ù‡ ÙØ±ÙˆØ´Ù†Ø¯Ù‡ Ø¨Ø§ Ø§Ùˆ ØµØ§Ø¯Ù‚ Ø§Ø³Øª.

---

**Ø®Ø±ÙˆØ¬ÛŒ Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ¸Ø§Ø±:**
Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· **ÛŒÚ© Ø§ÛŒØ¯Ù‡** (Ø¨Ù‡ØªØ±ÛŒÙ† Ú¯Ø²ÛŒÙ†Ù‡) Ø±Ø§ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø¯Ù‡ Ú©Ù‡ Ø´Ø§Ù…Ù„ Ù…ÙˆØ§Ø±Ø¯ Ø²ÛŒØ± Ø¨Ø§Ø´Ø¯:

1.  **Ø¹Ù†ÙˆØ§Ù† Ùˆ Ø´Ø±Ø­ Ø³Ù†Ø§Ø±ÛŒÙˆ:** (Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡Ù…ØŸ)
2.  **ÙØ±Ù…ÙˆÙ„ ØªØ±Ú©ÛŒØ¨ÛŒ:** (Ø§ÛŒÙ† Ø§ÛŒØ¯Ù‡ ØªØ±Ú©ÛŒØ¨ Ú©Ø¯Ø§Ù… "Ù…Ø¯Ù„ ØªØ¬Ø±Ø¨ÛŒ" + Ú©Ø¯Ø§Ù… "Ù…Ø­Ø±Ú© Ø§Ø­Ø³Ø§Ø³ÛŒ" Ø§Ø³ØªØŸ)
3.  **Ù…Ú©Ø§Ù†ÛŒØ²Ù… ÙˆÛŒØ±ÙˆØ³ÛŒ Ø´Ø¯Ù†:** (Ú†Ø±Ø§ Ø·Ø¨Ù‚ ØªØ¬Ø±Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ØŒ Ù…Ø±Ø¯Ù… Ø§ÛŒÙ† Ø±Ø§ Ù¾Ø®Ø´ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯ØŸ)
4.  **Ù…Ø±Ø§Ø­Ù„ Ø§Ø¬Ø±Ø§ÛŒÛŒ (Ú¯Ø§Ù…â€ŒØ¨Ù‡â€ŒÚ¯Ø§Ù…):** (Ø§Ø² Ú©Ø¬Ø§ Ø´Ø±ÙˆØ¹ Ú©Ù†Ù…ØŸ)
5.  **Ù…ØªÙ†/Ú©Ù¾Ø´Ù† Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:** (ÛŒÚ© Ù†Ù…ÙˆÙ†Ù‡ Ù…ØªÙ† Ø¬Ø°Ø§Ø¨ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹).
`.trim();

            document.getElementById('promptOutput').value = promptTemplate;
            const resultArea = document.getElementById('resultArea');
            resultArea.classList.remove('hidden');
            resultArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function copyToClipboard() {
            const copyText = document.getElementById("promptOutput");
            copyText.select();
            copyText.setSelectionRange(0, 99999);
            document.execCommand('copy');
            
            const copyBtnText = document.getElementById("copyText");
            const originalText = copyBtnText.innerText;
            copyBtnText.innerText = "Ú©Ù¾ÛŒ Ø´Ø¯!";
            
            setTimeout(() => {
                copyBtnText.innerText = originalText;
            }, 2000);
        }

        // ----------------------------------------------------------------------
        // --- Strategy Validator Logic (New Code) ------------------------------
        // ----------------------------------------------------------------------

        const translations = {
            en: {
                app_title: '<i class="fas fa-chess-board mr-2 rtl:ml-2"></i>Business Idea Prioritization',
                app_subtitle: 'Prioritize ideas using ICE, Weighted Matrix, and Risk/Reward Analysis.',
                btn_add: 'Add Idea',
                btn_print: 'Print/PDF',
                tab_ice: '1. ICE Scoring (Agility)',
                tab_weighted: '2. Weighted Matrix (Logic)',
                tab_risk: '3. Risk vs Reward (Visual)',
                // ICE Tab
                ice_explainer_title: 'How to understand ICE',
                ice_explainer_text: 'This method helps you identify "Quick Wins." It multiplies three factors to give a single score.<br><strong>The Goal:</strong> Find ideas that have high impact but are also easy to do. <span class="font-bold">Higher Score = Better Idea.</span>',
                ice_header: 'ICE Prioritization Table',
                th_idea: 'Business Idea',
                th_impact: 'Impact',
                sub_impact: 'Revenue/Win',
                th_confidence: 'Confidence',
                sub_confidence: 'Certainty',
                th_ease: 'Ease',
                sub_ease: 'Simplicity',
                th_score: 'ICE Score',
                // Weighted Tab
                weight_explainer_title: 'How to understand Weighted Matrix',
                weight_explainer_text: 'This method is for "Logic." Not all criteria are equal. In Iran, "Resilience" might be 2x more important than "Scalability."<br><strong>The Goal:</strong> Adjust percentages to match your priorities.',
                weight_header: 'Weighted Decision Matrix',
                lbl_profit: 'Profit %',
                lbl_resilience: 'Resilience %',
                lbl_speed: 'Speed %',
                lbl_scale: 'Scale %',
                th_profit: 'Profit',
                sub_profit: 'Financial Upside',
                th_resilience: 'Resilience',
                sub_resilience: 'Sanction Safety',
                th_speed: 'Speed',
                sub_speed: 'Launch Time',
                th_scale: 'Scale',
                sub_scale: 'Growth',
                th_total: 'Total',
                sub_total: 'Weighted Score',
                // Risk Tab
                risk_explainer_title: 'How to understand Risk vs. Reward',
                risk_explainer_text: 'This is a visual map. You want to be in the Top-Left (High Reward, Low Risk).<br><strong>Avoid the Bottom-Right:</strong> High risk with low reward is a "Death Trap."',
                risk_input_header: 'Input Data',
                legend_title: 'Zone Legend',
                leg_gold: 'Top Left: Golden Zone (Best)',
                leg_moon: 'Top Right: Moonshots (High Risk)',
                leg_safe: 'Bottom Left: Safe Bets',
                leg_death: 'Bottom Right: Death Trap',
                // Chart Labels
                chart_risk: 'Risk',
                chart_reward: 'Reward',
                btn_add_float: 'Add New Idea', // New translation
                btn_remove: 'Remove Idea' // New translation
            },
            fa: {
                app_title: '<i class="fas fa-chess-board mr-2 rtl:ml-2"></i> Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±',
                app_subtitle: 'Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ICEØŒ Ù…Ø§ØªØ±ÛŒØ³ ÙˆØ²Ù†ÛŒ Ùˆ ØªØ­Ù„ÛŒÙ„ Ø±ÛŒØ³Ú©/Ù¾Ø§Ø¯Ø§Ø´ Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ Ú©Ù†ÛŒØ¯.',
                btn_add: 'Ø§ÙØ²ÙˆØ¯Ù† Ø§ÛŒØ¯Ù‡',
                btn_print: 'Ú†Ø§Ù¾ / PDF',
                tab_ice: 'Û±. Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ ICE (Ú†Ø§Ø¨Ú©ÛŒ)',
                tab_weighted: 'Û². Ù…Ø§ØªØ±ÛŒØ³ ÙˆØ²Ù†ÛŒ (Ù…Ù†Ø·Ù‚)',
                tab_risk: 'Û³. Ø±ÛŒØ³Ú© Ùˆ Ù¾Ø§Ø¯Ø§Ø´ (Ø¨ØµØ±ÛŒ)',
                // ICE Tab
                ice_explainer_title: 'Ú†Ú¯ÙˆÙ†Ù‡ ICE Ø±Ø§ Ø¯Ø±Ú© Ú©Ù†ÛŒÙ…',
                ice_explainer_text: 'Ø§ÛŒÙ† Ø±ÙˆØ´ Ø¨Ù‡ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ "Ø¨Ø±Ø¯Ù‡Ø§ÛŒ Ø³Ø±ÛŒØ¹" Ú©Ù…Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ø³Ù‡ Ø¹Ø§Ù…Ù„ Ø±Ø§ Ø¶Ø±Ø¨ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.<br><strong>Ù‡Ø¯Ù:</strong> Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒÛŒ Ø¨Ø§ ØªØ£Ø«ÛŒØ± Ø¨Ø§Ù„Ø§ Ùˆ Ø§Ø¬Ø±Ø§ÛŒ Ø¢Ø³Ø§Ù† Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØ¯. <span class="font-bold">Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø§Ù„Ø§ØªØ± = Ø§ÛŒØ¯Ù‡ Ø¨Ù‡ØªØ±.</span>',
                ice_header: 'Ø¬Ø¯ÙˆÙ„ Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ ICE',
                th_idea: 'Ø§ÛŒØ¯Ù‡ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±',
                th_impact: 'ØªØ£Ø«ÛŒØ±',
                sub_impact: 'Ø¯Ø±Ø¢Ù…Ø¯/Ù¾ÛŒØ±ÙˆØ²ÛŒ',
                th_confidence: 'Ø§Ø·Ù…ÛŒÙ†Ø§Ù†',
                sub_confidence: 'Ù‚Ø·Ø¹ÛŒØª',
                th_ease: 'Ø³Ù‡ÙˆÙ„Øª',
                sub_ease: 'Ø³Ø§Ø¯Ú¯ÛŒ Ø§Ø¬Ø±Ø§',
                th_score: 'Ø§Ù…ØªÛŒØ§Ø² ICE',
                // Weighted Tab
                weight_explainer_title: 'Ú†Ú¯ÙˆÙ†Ù‡ Ù…Ø§ØªØ±ÛŒØ³ ÙˆØ²Ù†ÛŒ Ø±Ø§ Ø¯Ø±Ú© Ú©Ù†ÛŒÙ…',
                weight_explainer_text: 'Ø§ÛŒÙ† Ø±ÙˆØ´ Ø¨Ø±Ø§ÛŒ "Ù…Ù†Ø·Ù‚" Ø§Ø³Øª. Ù‡Ù…Ù‡ Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§ Ø¨Ø±Ø§Ø¨Ø± Ù†ÛŒØ³ØªÙ†Ø¯. Ø¯Ø± Ø§ÛŒØ±Ø§Ù†ØŒ "ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒ" Ù…Ù…Ú©Ù† Ø§Ø³Øª Û² Ø¨Ø±Ø§Ø¨Ø± Ù…Ù‡Ù…â€ŒØªØ± Ø§Ø² "Ù…Ù‚ÛŒØ§Ø³â€ŒÙ¾Ø°ÛŒØ±ÛŒ" Ø¨Ø§Ø´Ø¯.<br><strong>Ù‡Ø¯Ù:</strong> Ø¯Ø±ØµØ¯Ù‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§ÙˆÙ„ÙˆÛŒØª Ø®ÙˆØ¯ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯.',
                weight_header: 'Ù…Ø§ØªØ±ÛŒØ³ ØªØµÙ…ÛŒÙ…â€ŒÚ¯ÛŒØ±ÛŒ ÙˆØ²Ù†ÛŒ',
                lbl_profit: 'Ø³ÙˆØ¯ Ùª',
                lbl_resilience: 'ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒ Ùª',
                lbl_speed: 'Ø³Ø±Ø¹Øª Ùª',
                lbl_scale: 'Ù…Ù‚ÛŒØ§Ø³ Ùª',
                th_profit: 'Ø³ÙˆØ¯',
                sub_profit: 'Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø§Ù„ÛŒ',
                th_resilience: 'ØªØ§Ø¨â€ŒØ¢ÙˆØ±ÛŒ',
                sub_resilience: 'Ø§Ù…Ù†ÛŒØª Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± ØªØ­Ø±ÛŒÙ…',
                th_speed: 'Ø³Ø±Ø¹Øª',
                sub_speed: 'Ø²Ù…Ø§Ù† Ø¹Ø±Ø¶Ù‡',
                th_scale: 'Ù…Ù‚ÛŒØ§Ø³',
                sub_scale: 'Ø±Ø´Ø¯',
                th_total: 'Ù…Ø¬Ù…ÙˆØ¹',
                sub_total: 'Ø§Ù…ØªÛŒØ§Ø² ÙˆØ²Ù†ÛŒ',
                // Risk Tab
                risk_explainer_title: 'Ú†Ú¯ÙˆÙ†Ù‡ Ø±ÛŒØ³Ú© Ùˆ Ù¾Ø§Ø¯Ø§Ø´ Ø±Ø§ Ø¯Ø±Ú© Ú©Ù†ÛŒÙ…',
                risk_explainer_text: 'Ø§ÛŒÙ† ÛŒÚ© Ù†Ù‚Ø´Ù‡ Ø¨ØµØ±ÛŒ Ø§Ø³Øª. Ø´Ù…Ø§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¯Ø± Ú¯ÙˆØ´Ù‡ Ø¨Ø§Ù„Ø§-Ú†Ù¾ (Ù¾Ø§Ø¯Ø§Ø´ Ø¨Ø§Ù„Ø§ØŒ Ø±ÛŒØ³Ú© Ú©Ù…) Ø¨Ø§Ø´ÛŒØ¯.<br><strong>Ø§Ø¬ØªÙ†Ø§Ø¨ Ú©Ù†ÛŒØ¯:</strong> Ø±ÛŒØ³Ú© Ø¨Ø§Ù„Ø§ Ø¨Ø§ Ù¾Ø§Ø¯Ø§Ø´ Ú©Ù… "ØªÙ„Ù‡ Ù…Ø±Ú¯" Ø§Ø³Øª.',
                risk_input_header: 'Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ',
                legend_title: 'Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù†ÙˆØ§Ø­ÛŒ',
                leg_gold: 'Ø¨Ø§Ù„Ø§-Ú†Ù¾: Ù†Ø§Ø­ÛŒÙ‡ Ø·Ù„Ø§ÛŒÛŒ (Ø¨Ù‡ØªØ±ÛŒÙ†)',
                leg_moon: 'Ø¨Ø§Ù„Ø§-Ø±Ø§Ø³Øª: Ù¾Ø±ØªØ§Ø¨ Ø¨Ù‡ Ù…Ø§Ù‡ (Ø±ÛŒØ³Ú© Ø¨Ø§Ù„Ø§)',
                leg_safe: 'Ù¾Ø§ÛŒÛŒÙ†-Ú†Ù¾: Ø´Ø±Ø·â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ù†',
                leg_death: 'Ù¾Ø§ÛŒÛŒÙ†-Ø±Ø§Ø³Øª: ØªÙ„Ù‡ Ù…Ø±Ú¯ (Ø§Ø¬ØªÙ†Ø§Ø¨ Ú©Ù†ÛŒØ¯)',
                // Chart Labels
                chart_risk: 'Ø±ÛŒØ³Ú©',
                chart_reward: 'Ù¾Ø§Ø¯Ø§Ø´',
                btn_add_float: 'Ø§ÙØ²ÙˆØ¯Ù† Ø§ÛŒØ¯Ù‡ Ø¬Ø¯ÛŒØ¯', // New translation
                btn_remove: 'Ø­Ø°Ù Ø§ÛŒØ¯Ù‡' // New translation
            }
        };

        let currentLang = 'fa'; // Default to Persian since the main app is RTL

        // --- 1. State Management ---
        let ideas = [
            // 1. Online Tutoring Platform
            { id: 1, name: "Online Tutoring Platform", name_fa: "Ù¾Ù„ØªÙØ±Ù… ØªØ¯Ø±ÛŒØ³ Ø¢Ù†Ù„Ø§ÛŒÙ†", impact: 7, confidence: 8, ease: 7, w_profit: 4, w_resil: 4, w_speed: 5, w_scale: 3, risk: 3, reward: 6 },
            // 2. Specialty Coffee Roastery
            { id: 2, name: "Specialty Coffee Roastery", name_fa: "Ø±ÙˆØ³ØªØ±ÛŒ Ù‚Ù‡ÙˆÙ‡ ØªØ®ØµØµÛŒ", impact: 6, confidence: 6, ease: 5, w_profit: 3, w_resil: 3, w_speed: 4, w_scale: 2, risk: 5, reward: 5 },
            // 3. Local Artisan Marketplace
            { id: 3, name: "Local Artisan Marketplace", name_fa: "Ø¨Ø§Ø²Ø§Ø±Ú†Ù‡ Ù‡Ù†Ø±Ù‡Ø§ÛŒ Ù…Ø­Ù„ÛŒ", impact: 8, confidence: 5, ease: 4, w_profit: 4, w_resil: 5, w_speed: 2, w_scale: 4, risk: 4, reward: 7 },
            // 4. SaaS for Small Businesses
            { id: 4, name: "SaaS for Small Businesses", name_fa: "Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ø§Ø´ØªØ±Ø§Ú©ÛŒ (SaaS) Ø¨Ø±Ø§ÛŒ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±Ù‡Ø§ÛŒ Ú©ÙˆÚ†Ú©", impact: 9, confidence: 4, ease: 2, w_profit: 5, w_resil: 2, w_speed: 1, w_scale: 5, risk: 7, reward: 9 }
        ];

        let weights = { p: 0.3, r: 0.4, s: 0.2, sc: 0.1 };
        let iceChartInstance = null;
        let riskChartInstance = null;
        
        // --- 2. Localization and Rendering ---

        function setLang(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'fa' ? 'rtl' : 'ltr';
            
            // Toggle Button Styles
            const btnEn = document.getElementById('btn-en');
            const btnFa = document.getElementById('btn-fa');

            if(lang === 'en') {
                btnEn.classList.add('bg-blue-600', 'text-white');
                btnEn.classList.remove('text-gray-400', 'hover:text-white');
                btnFa.classList.remove('bg-blue-600', 'text-white');
                btnFa.classList.add('text-gray-400', 'hover:text-white');
            } else {
                btnFa.classList.add('bg-blue-600', 'text-white');
                btnFa.classList.remove('text-gray-400', 'hover:text-white');
                btnEn.classList.remove('bg-blue-600', 'text-white');
                btnEn.classList.add('text-gray-400', 'hover:text-white');
            }

            // Update Static Text
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(translations[lang][key]) {
                    el.innerHTML = translations[lang][key];
                }
            });

            // Re-render Dynamic Content
            renderAll();
        }

        function renderAll() {
            renderICETable();
            renderWeightedTable();
            renderRiskInputs();
            updateICEChart();
            updateRiskChart();
        }

        function switchTab(tabId) {
            ['ice', 'weighted', 'risk'].forEach(id => {
                const tab = document.getElementById(`tab-${id}`);
                if (tab) tab.classList.add('hidden');
                
                const btn = document.getElementById(`tab-btn-${id}`);
                if (btn) {
                    btn.classList.remove('tab-active');
                    btn.classList.add('tab-inactive');
                }
            });
            const selectedTab = document.getElementById(`tab-${tabId}`);
            if (selectedTab) selectedTab.classList.remove('hidden');
            
            const selectedBtn = document.getElementById(`tab-btn-${tabId}`);
            if (selectedBtn) {
                selectedBtn.classList.add('tab-active');
                selectedBtn.classList.remove('tab-inactive');
            }
        }

        // --- 3. CRUD Operations ---
        function addNewIdea() {
            const newId = ideas.length > 0 ? Math.max(...ideas.map(i => i.id)) + 1 : 1;
            const nameEn = `Idea ${newId}`;
            const nameFa = `Ø§ÛŒØ¯Ù‡ ${newId}`;
            
            ideas.push({
                id: newId,
                name: nameEn,
                name_fa: nameFa,
                impact: 5, confidence: 5, ease: 5,
                w_profit: 3, w_resil: 3, w_speed: 3, w_scale: 3,
                risk: 5, reward: 5
            });
            renderAll();
            
            // UX Improvement: Scroll to the bottom and focus on the new idea's name field
            // Use setTimeout to ensure the DOM update finishes rendering the new row
            setTimeout(() => {
                const newRowInput = document.querySelector(`#ice-table-body tr:last-child input[type="text"]`);
                if (newRowInput) {
                    newRowInput.focus();
                    newRowInput.select(); // Select the default text "Ø§ÛŒØ¯Ù‡ X"
                }
            }, 50);
        }

        function removeIdea(id) {
            ideas = ideas.filter(i => i.id !== id);
            renderAll();
        }

        // UX Fix: This function now updates the state but only triggers a full re-render when necessary (like blur/oninput for non-text fields)
        function updateIdea(id, field, value, redraw = true) {
            const idea = ideas.find(i => i.id === id);
            if (idea) {
                if (field === 'name') {
                    // Update the name based on current language
                    if(currentLang === 'fa') idea.name_fa = value;
                    else idea.name = value;
                }
                else {
                    // Numeric fields
                    idea[field] = parseFloat(value) || 0;
                }
                
                // Only re-render if explicitly requested (for blur or number inputs)
                if (redraw) {
                    renderAll(); 
                }
            }
        }

        function updateWeights() {
            const w1 = parseFloat(document.getElementById('w1').value) || 0;
            const w2 = parseFloat(document.getElementById('w2').value) || 0;
            const w3 = parseFloat(document.getElementById('w3').value) || 0;
            const w4 = parseFloat(document.getElementById('w4').value) || 0;
            
            const total = w1 + w2 + w3 + w4;
            if(total === 0) return; 

            weights = { p: w1 / 100, r: w2 / 100, s: w3 / 100, sc: w4 / 100 };
            renderWeightedTable();
        }

        // --- 4. Rendering Table Logic ---

        function getName(idea) {
            return currentLang === 'fa' ? (idea.name_fa || idea.name) : idea.name;
        }

        // ICE Table
        function renderICETable() {
            const tbody = document.getElementById('ice-table-body');
            if (!tbody) return;
            tbody.innerHTML = '';
            ideas.forEach(idea => {
                const score = (idea.impact * idea.confidence * idea.ease);
                const tr = document.createElement('tr');
                tr.className = "border-b border-gray-100 hover:bg-gray-50 transition";
                
                // UX Fix: Use onblur for text input to prevent focus loss while typing.
                tr.innerHTML = `
                    <td class="p-2">
                        <input type="text" 
                               value="${getName(idea)}" 
                               oninput="updateIdea(${idea.id}, 'name', this.value, false)" 
                               onblur="updateIdea(${idea.id}, 'name', this.value, true)"
                               class="text-start font-medium bg-transparent border-none focus:ring-0 w-full hover:bg-white px-2 rounded">
                    </td>
                    <td class="p-2"><input type="number" min="1" max="10" value="${idea.impact}" oninput="updateIdea(${idea.id}, 'impact', this.value, true)"></td>
                    <td class="p-2"><input type="number" min="1" max="10" value="${idea.confidence}" oninput="updateIdea(${idea.id}, 'confidence', this.value, true)"></td>
                    <td class="p-2"><input type="number" min="1" max="10" value="${idea.ease}" oninput="updateIdea(${idea.id}, 'ease', this.value, true)"></td>
                    <td class="p-2 text-center font-bold text-blue-600 bg-blue-50 border-l rtl:border-r rtl:border-l-0">${score}</td>
                    <td class="p-2 text-center">
                        <button onclick="removeIdea(${idea.id})" class="text-red-400 hover:text-red-600 transition" title="${translations[currentLang].btn_remove || 'Remove Idea'}">
                            <i class="fas fa-times"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Weighted Table
        function renderWeightedTable() {
            const tbody = document.getElementById('weighted-table-body');
            if (!tbody) return;
            tbody.innerHTML = '';
            ideas.forEach(idea => {
                const weightedScore = (
                    (idea.w_profit * weights.p) +
                    (idea.w_resil * weights.r) +
                    (idea.w_speed * weights.s) +
                    (idea.w_scale * weights.sc)
                ).toFixed(1);

                const tr = document.createElement('tr');
                tr.className = "border-b border-gray-100 hover:bg-gray-50 transition";
                // Note: We use oninput for number fields and re-render the whole content to update the score/charts immediately.
                tr.innerHTML = `
                    <td class="p-3 font-medium text-gray-700 text-start">${getName(idea)}</td>
                    <td class="p-2"><input type="number" min="1" max="5" value="${idea.w_profit}" oninput="updateIdea(${idea.id}, 'w_profit', this.value, true)"></td>
                    <td class="p-2"><input type="number" min="1" max="5" value="${idea.w_resil}" oninput="updateIdea(${idea.id}, 'w_resil', this.value, true)"></td>
                    <td class="p-2"><input type="number" min="1" max="5" value="${idea.w_speed}" oninput="updateIdea(${idea.id}, 'w_speed', this.value, true)"></td>
                    <td class="p-2"><input type="number" min="1" max="5" value="${idea.w_scale}" oninput="updateIdea(${idea.id}, 'w_scale', this.value, true)"></td>
                    <td class="p-2 text-center font-bold text-green-600 bg-green-50 text-lg border-l rtl:border-r rtl:border-l-0">${weightedScore}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Risk Inputs
        function renderRiskInputs() {
            const container = document.getElementById('risk-inputs');
            if (!container) return;
            container.innerHTML = '';
            ideas.forEach(idea => {
                const div = document.createElement('div');
                div.className = "bg-gray-50 p-2 rounded border border-gray-100 text-sm";
                // Note: We use oninput for number fields and re-render the whole content to update the chart immediately.
                div.innerHTML = `
                    <div class="font-bold mb-1 text-gray-700 truncate text-start">${getName(idea)}</div>
                    <div class="flex gap-2">
                        <div class="flex-1">
                            <label class="text-xs text-red-500 font-semibold block mb-1">${translations[currentLang].chart_risk} (X)</label>
                            <input type="number" min="1" max="10" value="${idea.risk}" oninput="updateIdea(${idea.id}, 'risk', this.value, true)">
                        </div>
                        <div class="flex-1">
                            <label class="text-xs text-green-600 font-semibold block mb-1">${translations[currentLang].chart_reward} (Y)</label>
                            <input type="number" min="1" max="10" value="${idea.reward}" oninput="updateIdea(${idea.id}, 'reward', this.value, true)">
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // --- 5. Charts Logic ---
        
        function updateICEChart() {
            const ctx = document.getElementById('iceChart');
            if (!ctx) return; // Guard clause
            const dataScores = ideas.map(i => i.impact * i.confidence * i.ease);
            const labels = ideas.map(i => getName(i));

            if (iceChartInstance) iceChartInstance.destroy();

            // Font family based on lang
            const fontFamily = currentLang === 'fa' ? "'Vazirmatn', sans-serif" : "'Inter', sans-serif";

            iceChartInstance = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: translations[currentLang].th_score,
                        data: dataScores,
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { 
                        y: { beginAtZero: true, ticks: { font: { family: fontFamily } } },
                        x: { ticks: { font: { family: fontFamily } } }
                    },
                    plugins: {
                        legend: { labels: { font: { family: fontFamily } } }
                    }
                }
            });
        }

        function updateRiskChart() {
            const ctx = document.getElementById('riskChart');
            if (!ctx) return; // Guard clause
            const fontFamily = currentLang === 'fa' ? "'Vazirmatn', sans-serif" : "'Inter', sans-serif";
            const xLabel = translations[currentLang].chart_risk;
            const yLabel = translations[currentLang].chart_reward;
            
            // Draw background quadrants
            const backgroundPlugin = {
                id: 'customBackground',
                beforeDraw: (chart) => {
                    const { ctx, chartArea: { left, top, right, bottom, width, height } } = chart;
                    const midX = left + width / 2;
                    const midY = top + height / 2;

                    ctx.save();
                    // Colors
                    ctx.fillStyle = 'rgba(220, 252, 231, 0.3)'; ctx.fillRect(left, top, width/2, height/2); // Top Left (High Reward, Low Risk)
                    ctx.fillStyle = 'rgba(254, 252, 232, 0.3)'; ctx.fillRect(midX, top, width/2, height/2); // Top Right (High Reward, High Risk)
                    ctx.fillStyle = 'rgba(239, 246, 255, 0.3)'; ctx.fillRect(left, midY, width/2, height/2); // Bottom Left (Low Reward, Low Risk)
                    ctx.fillStyle = 'rgba(254, 242, 242, 0.3)'; ctx.fillRect(midX, midY, width/2, height/2); // Bottom Right (Low Reward, High Risk)

                    // Crosshair
                    ctx.strokeStyle = '#9ca3af'; ctx.lineWidth = 1; ctx.setLineDash([5, 5]);
                    ctx.beginPath(); ctx.moveTo(midX, top); ctx.lineTo(midX, bottom); ctx.stroke();
                    ctx.beginPath(); ctx.moveTo(left, midY); ctx.lineTo(right, midY); ctx.stroke();
                    ctx.restore();
                }
            };

            if (riskChartInstance) riskChartInstance.destroy();

            riskChartInstance = new Chart(ctx.getContext('2d'), {
                type: 'bubble',
                data: {
                    datasets: ideas.map((idea, index) => ({
                        label: getName(idea),
                        data: [{ x: idea.risk, y: idea.reward, r: 8 }],
                        backgroundColor: `hsl(${index * 60}, 70%, 50%)`,
                        borderColor: 'white',
                        borderWidth: 2
                    }))
                },
                plugins: [backgroundPlugin],
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            title: { display: true, text: xLabel + ' â† (Low) | (High) â†’', font: {weight: 'bold', family: fontFamily} },
                            min: 0, max: 10, grid: { display: false },
                            ticks: { font: { family: fontFamily } }
                        },
                        y: { 
                            title: { display: true, text: yLabel + ' â†‘ (High) | (Low) â†“', font: {weight: 'bold', family: fontFamily} },
                            min: 0, max: 10, grid: { display: false },
                            ticks: { font: { family: fontFamily } }
                        }
                    },
                    plugins: {
                        legend: { position: 'bottom', labels: { font: { family: fontFamily } } },
                        tooltip: {
                            bodyFont: { family: fontFamily },
                            titleFont: { family: fontFamily },
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ` (${xLabel}: ${context.raw.x}, ${yLabel}: ${context.raw.y})`;
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>