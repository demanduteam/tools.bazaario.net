<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฌุนุจูโุงุจุฒุงุฑ ุจุงุฒุงุฑุงุจ | Marketing Toolkit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <!-- Fixed Lucide Script Source -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- New Dependencies for Strategy Validator -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Combined Google Fonts: Vazirmatn for Persian, Inter for English -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Vazirmatn:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f8fafc;
        }
        /* Style adjustments for LTR/RTL font switching in the new tool */
        html[lang="en"] body { 
            font-family: 'Inter', sans-serif; 
        }

        .gradient-text {
            background: linear-gradient(to right, #4f46e5, #9333ea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
        .tool-card {
            transition: all 0.3s ease;
        }
        .tool-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- New styles for Strategy Validator --- */
        .tab-active { border-bottom: 2px solid #2563eb; color: #2563eb; font-weight: 600; }
        .tab-inactive { color: #6b7280; font-weight: 400; }
        .tab-inactive:hover { color: #374151; }
        
        input[type="number"] { width: 100%; padding: 4px; border: 1px solid #d1d5db; border-radius: 4px; text-align: center; }
        input[type="number"]:focus { outline: none; border-color: #2563eb; ring: 2px; }
        
        th .subtitle { display: block; font-size: 0.75rem; color: #6b7280; font-weight: 400; margin-top: 2px; line-height: 1.1; }
        
        /* RTL Helper Overrides for Validator */
        html[dir="rtl"] .rounded-r { border-top-right-radius: 0; border-bottom-right-radius: 0; border-top-left-radius: 0.25rem; border-bottom-left-radius: 0.25rem; }
        html[dir="rtl"] .border-l-4 { border-left-width: 0; border-right-width: 4px; }
        html[dir="rtl"] .mr-1 { margin-left: 0.25rem; margin-right: 0; }
        html[dir="rtl"] .mr-2 { margin-left: 0.5rem; margin-right: 0; }
        html[dir="rtl"] .ml-4 { margin-right: 1rem; margin-left: 0; }
        html[dir="rtl"] .text-left { text-align: right; }
    </style>
</head>
<body class="text-slate-800 h-screen overflow-hidden flex">

    <!-- Sidebar (Desktop) -->
    <aside class="hidden md:flex flex-col w-64 bg-slate-900 text-slate-300 h-full flex-shrink-0">
        <div class="p-6 border-b border-slate-800 flex items-center gap-3">
            <div class="bg-indigo-600 p-2 rounded-lg">
                <i data-lucide="layers" class="text-white w-6 h-6"></i>
            </div>
            <span class="font-bold text-white text-lg tracking-wide">ูุงุฑฺฉุชูฺฏโูพููุงุณ</span>
        </div>

        <nav class="flex-1 overflow-y-auto py-6 px-3 space-y-1">
            <button onclick="showView('dashboard')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-800 transition-colors text-right group" id="nav-dashboard">
                <i data-lucide="layout-grid" class="w-5 h-5 group-hover:text-white"></i>
                <span class="font-medium group-hover:text-white">ุฏุงุดุจูุฑุฏ ุงุจุฒุงุฑูุง</span>
            </button>
            
            <div class="pt-4 pb-2 px-4 text-xs font-semibold text-slate-500 uppercase tracking-wider">ุงุจุฒุงุฑูุง ููุดููุฏ</div>
            
            <button onclick="showView('viral-tool')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl bg-indigo-600 text-white shadow-lg shadow-indigo-900/20 transition-all text-right" id="nav-viral">
                <i data-lucide="zap" class="w-5 h-5"></i>
                <span class="font-medium">ุงุณุชุฑุงุชฺ ูุงุฑุงู</span>
            </button>
            
            <!-- NEW TOOL NAVIGATION -->
            <button onclick="showView('strategy-validator')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-800 transition-colors text-right group" id="nav-strategy">
                <i data-lucide="bar-chart-3" class="w-5 h-5 group-hover:text-white"></i>
                <span class="font-medium group-hover:text-white">ุงูููุชโุจูุฏ ุงุฏูโูุง ฺฉุณุจโูฺฉุงุฑ</span>
            </button>

            <button class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-800 transition-colors text-right opacity-60 cursor-not-allowed group">
                <i data-lucide="pen-tool" class="w-5 h-5"></i>
                <span>ฺฉูพุดูโููุณ (ุจูโุฒูุฏ)</span>
                <i data-lucide="lock" class="w-3 h-3 mr-auto"></i>
            </button>
            
            <button class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-800 transition-colors text-right opacity-60 cursor-not-allowed group">
                <i data-lucide="hash" class="w-5 h-5"></i>
                <span>ูุดุชฺฏ ุงุจ (ุจูโุฒูุฏ)</span>
                <i data-lucide="lock" class="w-3 h-3 mr-auto"></i>
            </button>
        </nav>

        <div class="p-4 border-t border-slate-800">
            <div class="flex items-center gap-3 p-2 rounded-lg bg-slate-800/50 border border-slate-700">
                <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-500 flex items-center justify-center text-white text-xs font-bold">
                    ME
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-white truncate">ฺฉุงุฑุจุฑ ูููุงู</p>
                    <p class="text-xs text-slate-500 truncate">ุทุฑุญ ุฑุงฺฏุงู</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 h-full overflow-y-auto bg-slate-50 relative custom-scrollbar">
        <!-- Mobile Header -->
        <div class="md:hidden flex items-center justify-between p-4 bg-white border-b border-slate-200 sticky top-0 z-20">
            <div class="flex items-center gap-2">
                <div class="bg-indigo-600 p-1.5 rounded-lg">
                    <i data-lucide="layers" class="text-white w-5 h-5"></i>
                </div>
                <span class="font-bold text-slate-900">ูุงุฑฺฉุชูฺฏโูพููุงุณ</span>
            </div>
            <button onclick="toggleMobileMenu()" class="p-2 text-slate-600 hover:bg-slate-100 rounded-lg">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
        </div>

        <!-- VIEW 1: DASHBOARD (Hub) -->
        <div id="view-dashboard" class="p-6 md:p-10 max-w-7xl mx-auto fade-in">
            <header class="mb-10">
                <h1 class="text-3xl font-bold text-slate-900 mb-2">ุณูุงูุ ุจู ุฌุนุจูโุงุจุฒุงุฑ ุฑุดุฏ ุฎูุด ุขูุฏุฏ ๐</h1>
                <p class="text-slate-500 text-lg">ฺฉุฏุงู ุงุจุฒุงุฑ ุฑุง ุจุฑุง ุดุฑูุน ฺฉููพู ุงูุฑูุฒ ุงูุชุฎุงุจ ูโฺฉูุฏุ</p>
            </header>

            <!-- Featured Tool (Viral Generator) -->
            <div class="mb-12">
                <h2 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2">
                    <i data-lucide="star" class="w-4 h-4"></i>
                    ุงุจุฒุงุฑ ูพุดููุงุฏ
                </h2>
                <div class="bg-white rounded-3xl p-1 shadow-xl border border-indigo-100 tool-card relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-indigo-50 rounded-full -mr-16 -mt-16 blur-3xl opacity-50 transition-opacity group-hover:opacity-70"></div>
                    
                    <div class="flex flex-col md:flex-row gap-6 p-6 md:p-8 relative z-10">
                        <div class="w-16 h-16 rounded-2xl bg-indigo-100 text-indigo-600 flex items-center justify-center flex-shrink-0">
                            <i data-lucide="zap" class="w-8 h-8"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <h3 class="text-2xl font-bold text-slate-900">ุงุณุชุฑุงุชฺ ูุงุฑุงูโูฺฉุฑ</h3>
                                <span class="bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-1 rounded-full">ููุด ูุตููุน</span>
                            </div>
                            <p class="text-slate-600 leading-relaxed mb-6 max-w-2xl">
                                ุจุง ุงุณุชูุงุฏู ุงุฒ ุฑูุงูุดูุงุณ ูุฑูุด ู ด ูุฏู ุงุซุจุงุช ุดุฏู ุฏุฑ ุจุงุฒุงุฑ ุงุฑุงูุ ุณูุงุฑููุง ุชุจูุบุงุช ุจุณุงุฒุฏ ฺฉู ูุฎุงุทุจ ูุชูุงูุฏ ูุงุฏุฏู ุจฺฏุฑุฏ. ููุงุณุจ ุจุฑุง ุงุณุชูุฑุ ูพุณุช ู ูุฏู.
                            </p>
                            <div class="flex flex-wrap gap-2 mb-6">
                                <span class="px-3 py-1 bg-slate-100 text-slate-600 rounded-lg text-sm flex items-center gap-1"><i data-lucide="check" class="w-3 h-3"></i> ุงุฏู ุงุณุชูุฑ</span>
                                <span class="px-3 py-1 bg-slate-100 text-slate-600 rounded-lg text-sm flex items-center gap-1"><i data-lucide="check" class="w-3 h-3"></i> ุณูุงุฑู ูุฏู</span>
                                <span class="px-3 py-1 bg-slate-100 text-slate-600 rounded-lg text-sm flex items-center gap-1"><i data-lucide="check" class="w-3 h-3"></i> ุชุญูู ุฑูุงูุดูุงุณ</span>
                            </div>
                            <button onclick="showView('viral-tool')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-xl font-bold transition-all shadow-lg shadow-indigo-500/30 flex items-center gap-2">
                                ุดุฑูุน ุณุงุฎุช ุงุณุชุฑุงุชฺ
                                <i data-lucide="arrow-left" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other Tools Grid -->
            <h2 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2">
                <i data-lucide="grid" class="w-4 h-4"></i>
                ุณุงุฑ ุงุจุฒุงุฑูุง
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <!-- Tool 2 (Caption Writer - Coming Soon) -->
                <div class="bg-white rounded-2xl p-6 border border-slate-200 opacity-60 grayscale hover:grayscale-0 hover:opacity-100 transition-all cursor-not-allowed">
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-12 h-12 rounded-xl bg-pink-100 text-pink-600 flex items-center justify-center">
                            <i data-lucide="pen-tool" class="w-6 h-6"></i>
                        </div>
                        <span class="bg-slate-100 text-slate-500 text-xs px-2 py-1 rounded-lg">ุจูโุฒูุฏ</span>
                    </div>
                    <h3 class="font-bold text-lg mb-1">ฺฉูพุดูโููุณ ุฌุงุฏู</h3>
                    <p class="text-sm text-slate-500">ููุดุชู ฺฉูพุดูโูุง ุชุนุงูู ุงูุณุชุงฺฏุฑุงู ุฏุฑ ณ ุซุงูู.</p>
                </div>

                <!-- Tool 3 (Strategy Validator - ACTIVE) -->
                <div onclick="showView('strategy-validator')" class="bg-white rounded-2xl p-6 border border-slate-200 tool-card cursor-pointer group hover:border-blue-300">
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-12 h-12 rounded-xl bg-blue-100 text-blue-600 flex items-center justify-center">
                            <i data-lucide="bar-chart-3" class="w-6 h-6"></i>
                        </div>
                        <span class="bg-blue-100 text-blue-700 text-xs px-2 py-1 rounded-lg font-bold">ุฌุฏุฏ!</span>
                    </div>
                    <h3 class="font-bold text-lg mb-1">ุงูููุชโุจูุฏ ุงุฏูโูุง ฺฉุณุจโูฺฉุงุฑ</h3>
                    <p class="text-sm text-slate-500">ุชุฌุฒู ู ุชุญูู ุงุฏูโูุง ุจุง ุงุณุชูุงุฏู ุงุฒ ูุชุฏูุง ICE ู Weighted Matrix.</p>
                    <div class="mt-4 text-blue-600 text-xs font-semibold flex items-center gap-1">
                        <i data-lucide="arrow-left" class="w-3 h-3"></i> ุดุฑูุน ุชุญูู
                    </div>
                </div>

                <!-- Tool 4 (Content Calendar - Coming Soon) -->
                <div class="bg-white rounded-2xl p-6 border border-slate-200 opacity-60 grayscale hover:grayscale-0 hover:opacity-100 transition-all cursor-not-allowed">
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-12 h-12 rounded-xl bg-green-100 text-green-600 flex items-center justify-center">
                            <i data-lucide="bar-chart-2" class="w-6 h-6"></i>
                        </div>
                        <span class="bg-slate-100 text-slate-500 text-xs px-2 py-1 rounded-lg">ุจูโุฒูุฏ</span>
                    </div>
                    <h3 class="font-bold text-lg mb-1">ุชููู ูุญุชูุง</h3>
                    <p class="text-sm text-slate-500">ุจุฑูุงููโุฑุฒ ณฐ ุฑูุฒู ุจุฑุง ุดุจฺฉูโูุง ุงุฌุชูุงุน.</p>
                </div>
            </div>
        </div>

        <!-- VIEW 2: VIRAL TOOL (The Application) -->
        <div id="view-viral-tool" class="hidden min-h-full flex flex-col fade-in">
            <!-- Tool Header -->
            <div class="bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between sticky top-0 z-10">
                <div class="flex items-center gap-3">
                    <button onclick="showView('dashboard')" class="md:hidden p-2 -mr-2 text-slate-500">
                        <i data-lucide="arrow-right"></i>
                    </button>
                    <div class="w-10 h-10 rounded-lg bg-indigo-100 text-indigo-600 flex items-center justify-center">
                        <i data-lucide="zap" class="w-5 h-5"></i>
                    </div>
                    <div>
                        <h2 class="font-bold text-slate-900">ูุงุฑุงูโููฺฉุฑ</h2>
                        <p class="text-xs text-slate-500">ููุชูุฑ ุชููุฏ ุงุฏู ูุจุชู ุจุฑ ด ูุฏู ุชุฌุฑุจ</p>
                    </div>
                </div>
                <button onclick="showView('dashboard')" class="hidden md:flex items-center gap-2 text-sm text-slate-500 hover:text-indigo-600 transition-colors">
                    <i data-lucide="layout-grid" class="w-4 h-4"></i>
                    ุจุงุฒฺฏุดุช ุจู ุฏุงุดุจูุฑุฏ
                </button>
            </div>

            <!-- Content Container -->
            <div class="flex-1 p-4 md:p-8 max-w-5xl mx-auto w-full">
                
                <!-- Educational Cards (Collapsible) -->
                <details class="group bg-white border border-slate-200 rounded-2xl mb-8 overflow-hidden">
                    <summary class="flex items-center justify-between p-4 cursor-pointer bg-slate-50 hover:bg-slate-100 transition-colors select-none">
                        <div class="flex items-center gap-2 font-bold text-slate-700">
                            <i data-lucide="book-open" class="w-5 h-5 text-indigo-500"></i>
                            <span>ุฑุงูููุง ูุฏูโูุง: ฺฺฏููู ููุด ูุตููุน ุงุฏู ูโุฏูุฏุ</span>
                        </div>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-slate-400 group-open:rotate-180 transition-transform"></i>
                    </summary>
                    <div class="p-6 border-t border-slate-200">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <!-- Model 1 -->
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center shrink-0 text-sm font-bold">1</div>
                                <div>
                                    <h4 class="font-bold text-sm">ุงุญุชุฑุงู VIP</h4>
                                    <p class="text-xs text-slate-500 mt-1">ุงุฑุณุงู ุฏุนูุชโูุงูู ุง ูุฏู ฺฉู ูุฎุงุทุจ ุจุฑุง ูพุฒ ุฏุงุฏู ุงุณุชูุฑ ฺฉูุฏ.</p>
                                </div>
                            </div>
                            <!-- Model 2 -->
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center shrink-0 text-sm font-bold">2</div>
                                <div>
                                    <h4 class="font-bold text-sm">ูุดุงุฑฺฉุช ุฌูุน</h4>
                                    <p class="text-xs text-slate-500 mt-1">ูุณุงุจูุงุช ฺฉู ฺฉุงุฑุจุฑ ุจุฑุง ุจุฑูุฏู ุดุฏูุ ุจุฑุง ุดูุง ุชุจูุบ ูโฺฉูุฏ.</p>
                                </div>
                            </div>
                            <!-- Model 3 -->
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center shrink-0 text-sm font-bold">3</div>
                                <div>
                                    <h4 class="font-bold text-sm">ููุงุณู ุฌูุฌุงู</h4>
                                    <p class="text-xs text-slate-500 mt-1">ููุงุณู ุดูุงู ุจุง ุฑูุจุง ฺฉู ุจุงุนุซ ุจุญุซ ู ุทุฑูุฏุงุฑ ูโุดูุฏ.</p>
                                </div>
                            </div>
                            <!-- Model 4 -->
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center shrink-0 text-sm font-bold">4</div>
                                <div>
                                    <h4 class="font-bold text-sm">ุชุงุจูุดฺฉู</h4>
                                    <p class="text-xs text-slate-500 mt-1">ฺฏูุชู ุญุฑูโูุง ูฺฏู (ูุซู ููุช) ฺฉู ุฏฺฏุฑุงู ุขู ุฑุง ุจุงุฒูุดุฑ ูโฺฉููุฏ.</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-indigo-50 p-3 rounded-lg text-xs text-indigo-800 flex items-center gap-2">
                            <i data-lucide="info" class="w-4 h-4"></i>
                            ููุด ูุตููุน ุงู ูุฏูโูุง ุฑุง ุจุง <b>ต ูุญุฑฺฉ ุงุญุณุงุณ (ููุชุ ูุฐุชุ ูุฏุฑุชุ ุงููุชุ ุงุฑุฒุด)</b> ุชุฑฺฉุจ ูโฺฉูุฏ.
                        </div>
                    </div>
                </details>

                <!-- Input Panel -->
                <div class="bg-white rounded-3xl shadow-sm border border-slate-200 p-6 md:p-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-2">ุญูุฒู ฺฉุงุฑ ุดูุง</label>
                            <input type="text" id="businessInput" placeholder="ูุซุงู: ูุฑูุดฺฏุงู ุขููุงู ุดุงูุ ฺฉุงูู..." class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all outline-none bg-slate-50 focus:bg-white">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-2">ูุฎุงุทุจ ูุฏู</label>
                            <input type="text" id="customerInput" placeholder="ูุซุงู: ุฎุงููโูุง ุฎุงููโุฏุงุฑุ ุฏุงูุดุฌูุงู..." class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all outline-none bg-slate-50 focus:bg-white">
                        </div>
                    </div>

                    <div class="mb-8">
                        <label class="block text-sm font-bold text-slate-700 mb-2">ููุน ูุญุชูุง</label>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3">
                            <label class="cursor-pointer">
                                <input type="radio" name="contentType" value="mixed" class="peer sr-only" checked>
                                <div class="p-3 rounded-xl border border-slate-200 peer-checked:border-indigo-500 peer-checked:bg-indigo-50 text-center transition-all h-full flex flex-col items-center justify-center gap-2 hover:bg-slate-50">
                                    <i data-lucide="wand-2" class="w-5 h-5 text-slate-400 peer-checked:text-indigo-600"></i>
                                    <span class="text-sm font-medium text-slate-600 peer-checked:text-indigo-800">ูพุดููุงุฏ ููุดููุฏ</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="contentType" value="stories" class="peer sr-only">
                                <div class="p-3 rounded-xl border border-slate-200 peer-checked:border-indigo-500 peer-checked:bg-indigo-50 text-center transition-all h-full flex flex-col items-center justify-center gap-2 hover:bg-slate-50">
                                    <i data-lucide="instagram" class="w-5 h-5 text-slate-400 peer-checked:text-indigo-600"></i>
                                    <span class="text-sm font-medium text-slate-600 peer-checked:text-indigo-800">ุงุณุชูุฑ/ูุงุชุณุงูพ</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="contentType" value="text_image" class="peer sr-only">
                                <div class="p-3 rounded-xl border border-slate-200 peer-checked:border-indigo-500 peer-checked:bg-indigo-50 text-center transition-all h-full flex flex-col items-center justify-center gap-2 hover:bg-slate-50">
                                    <i data-lucide="image" class="w-5 h-5 text-slate-400 peer-checked:text-indigo-600"></i>
                                    <span class="text-sm font-medium text-slate-600 peer-checked:text-indigo-800">ูพุณุช ุงุณูุงุฏ</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="contentType" value="simple_video" class="peer sr-only">
                                <div class="p-3 rounded-xl border border-slate-200 peer-checked:border-indigo-500 peer-checked:bg-indigo-50 text-center transition-all h-full flex flex-col items-center justify-center gap-2 hover:bg-slate-50">
                                    <i data-lucide="video" class="w-5 h-5 text-slate-400 peer-checked:text-indigo-600"></i>
                                    <span class="text-sm font-medium text-slate-600 peer-checked:text-indigo-800">ูุฏู ุณุงุฏู</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <button onclick="generatePrompt()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg shadow-indigo-500/30 flex justify-center items-center gap-2 text-lg">
                        <i data-lucide="sparkles"></i>
                        ุชููุฏ ุงุณุชุฑุงุชฺ
                    </button>
                </div>

                <!-- Result Area -->
                <div id="resultArea" class="hidden mt-8 animation-fade-in">
                    <div class="bg-slate-900 rounded-2xl overflow-hidden shadow-2xl ring-1 ring-white/10">
                        <div class="px-4 py-3 bg-slate-800/50 border-b border-white/5 flex justify-between items-center">
                            <span class="text-xs font-mono text-indigo-400 uppercase tracking-widest">AI Prompt Generated</span>
                            <button onclick="copyToClipboard()" class="flex items-center gap-2 text-xs text-slate-400 hover:text-white transition-colors bg-white/5 hover:bg-white/10 px-3 py-1.5 rounded-lg">
                                <i data-lucide="copy" class="w-3 h-3"></i>
                                <span id="copyText">ฺฉูพ ุฏุณุชูุฑ</span>
                            </button>
                        </div>
                        <textarea id="promptOutput" readonly class="w-full h-80 bg-slate-900 text-slate-300 font-mono text-sm resize-none outline-none custom-scrollbar p-6 leading-relaxed"></textarea>
                    </div>
                    
                    <div class="mt-4 p-4 rounded-xl bg-gradient-to-r from-indigo-50 to-white border border-indigo-100 flex gap-4 shadow-sm">
                        <div class="bg-indigo-100 p-2 rounded-full h-fit text-indigo-600">
                            <i data-lucide="message-square" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-800 text-sm mb-1">ูุฏู ุจุนุฏ ฺุณุชุ</h4>
                            <p class="text-sm text-slate-600">ูุชู ุจุงูุง ุฑุง ฺฉูพ ฺฉูุฏ ู ุฏุฑ ฺุชโุจุงุชโูุง ูุซู <b>ChatGPT</b> ุง <b>Claude</b> ุจูุฑุณุชุฏ. ูุชุฌู ฺฉ ุณูุงุฑู ฺฉุงูู ู ูููุฏุณ ุดุฏู ุฎูุงูุฏ ุจูุฏ.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW 3: STRATEGY VALIDATOR (New Tool) -->
        <div id="view-strategy-validator" class="hidden min-h-full flex flex-col fade-in">
            <div class="flex-1 max-w-7xl mx-auto w-full p-4 md:p-8">
                <!-- Content from the new tool, adapted to fit the main app's flow -->
                
                <div class="bg-white shadow-lg rounded-xl overflow-hidden flex flex-col mb-8">
                    
                    <!-- Header -->
                    <div class="bg-gray-900 text-white p-6 flex flex-col md:flex-row justify-between items-center gap-4">
                        <div class="text-center md:text-start">
                            <h1 class="text-2xl font-bold" data-i18n="app_title"><i class="fas fa-chess-board mr-2 rtl:ml-2"></i>ุงูููุชโุจูุฏ ุงุฏูโูุง ฺฉุณุจโูฺฉุงุฑ</h1>
                            <p class="text-gray-400 text-sm mt-1" data-i18n="app_subtitle">ุงุฏูโูุง ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ ICEุ ูุงุชุฑุณ ูุฒู ู ุชุญูู ุฑุณฺฉ/ูพุงุฏุงุด ุงูููุชโุจูุฏ ฺฉูุฏ.</p>
                        </div>
                        
                        <div class="flex flex-col items-center md:items-end gap-3">
                            <!-- Lang Toggle -->
                            <div class="bg-gray-800 rounded-lg p-1 flex">
                                <button onclick="setLang('en')" id="btn-en" class="px-3 py-1 rounded text-xs font-bold text-gray-400 hover:text-white transition">English</button>
                                <button onclick="setLang('fa')" id="btn-fa" class="px-3 py-1 rounded text-xs font-bold bg-blue-600 text-white transition">ูุงุฑุณ</button>
                            </div>

                            <div class="flex gap-2">
                                <button onclick="addNewIdea()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg transition text-sm font-medium flex items-center">
                                    <i class="fas fa-plus mr-1 rtl:ml-1"></i> <span data-i18n="btn_add">ุงูุฒูุฏู ุงุฏู</span>
                                </button>
                                <button onclick="window.print()" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition text-sm font-medium flex items-center">
                                    <i class="fas fa-print mr-1 rtl:ml-1"></i> <span data-i18n="btn_print">ฺุงูพ / PDF</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Tabs -->
                    <div class="flex flex-wrap border-b border-gray-200 px-6">
                        <button onclick="switchTab('ice')" id="tab-btn-ice" class="tab-active py-4 px-4 md:px-6 focus:outline-none text-sm md:text-base" data-i18n="tab_ice">
                            ฑ. ุงูุชุงุฒุฏู ICE (ฺุงุจฺฉ)
                        </button>
                        <button onclick="switchTab('weighted')" id="tab-btn-weighted" class="tab-inactive py-4 px-4 md:px-6 focus:outline-none text-sm md:text-base" data-i18n="tab_weighted">
                            ฒ. ูุงุชุฑุณ ูุฒู (ููุทู)
                        </button>
                        <button onclick="switchTab('risk')" id="tab-btn-risk" class="tab-inactive py-4 px-4 md:px-6 focus:outline-none text-sm md:text-base" data-i18n="tab_risk">
                            ณ. ุฑุณฺฉ ู ูพุงุฏุงุด (ุจุตุฑ)
                        </button>
                    </div>

                    <!-- Content Area -->
                    <div class="p-6 flex-grow">
                        
                        <!-- TAB 1: ICE SCORING -->
                        <div id="tab-ice" class="block">
                            <!-- Explainer Box -->
                            <div class="bg-blue-50 border-l-4 rtl:border-r-4 border-blue-500 p-4 mb-6 rounded shadow-sm">
                                <h3 class="font-bold text-blue-800 text-sm mb-1">
                                    <i class="fas fa-info-circle mr-1 rtl:ml-1"></i> <span data-i18n="ice_explainer_title">ฺฺฏููู ICE ุฑุง ุฏุฑฺฉ ฺฉูู</span>
                                </h3>
                                <p class="text-xs text-blue-700 leading-relaxed" data-i18n="ice_explainer_text">
                                    ุงู ุฑูุด ุจู ุดูุงุณุง "ุจุฑุฏูุง ุณุฑุน" ฺฉูฺฉ ูโฺฉูุฏ. ุณู ุนุงูู ุฑุง ุถุฑุจ ูโฺฉูุฏ.<br><strong>ูุฏู:</strong> ุงุฏูโูุง ุจุง ุชุฃุซุฑ ุจุงูุง ู ุงุฌุฑุง ุขุณุงู ุฑุง ูพุฏุง ฺฉูุฏ. <span class="font-bold">ุงูุชุงุฒ ุจุงูุงุชุฑ = ุงุฏู ุจูุชุฑ.</span>
                                </p>
                            </div>

                            <h2 class="text-xl font-semibold text-gray-800 mb-4" data-i18n="ice_header">ุฌุฏูู ุงูููุชโุจูุฏ ICE</h2>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full text-left rtl:text-right border-collapse">
                                    <thead>
                                        <tr class="bg-gray-50 border-b align-top">
                                            <th class="p-3 w-1/4 align-middle" data-i18n="th_idea">ุงุฏู ฺฉุณุจโูฺฉุงุฑ</th>
                                            <th class="p-3 text-center w-32">
                                                <span data-i18n="th_impact">ุชุฃุซุฑ</span>
                                                <span class="subtitle" data-i18n="sub_impact">ุฏุฑุขูุฏ/ูพุฑูุฒ</span>
                                            </th>
                                            <th class="p-3 text-center w-32">
                                                <span data-i18n="th_confidence">ุงุทููุงู</span>
                                                <span class="subtitle" data-i18n="sub_confidence">ูุทุนุช</span>
                                            </th>
                                            <th class="p-3 text-center w-32">
                                                <span data-i18n="th_ease">ุณูููุช</span>
                                                <span class="subtitle" data-i18n="sub_ease">ุณุงุฏฺฏ ุงุฌุฑุง</span>
                                            </th>
                                            <th class="p-3 text-center w-32 bg-blue-50 font-bold border-l rtl:border-r rtl:border-l-0 align-middle">
                                                <span data-i18n="th_score">ุงูุชุงุฒ ICE</span>
                                                <span class="subtitle font-normal">I ร C ร E</span>
                                            </th>
                                            <th class="p-3 w-10 align-middle"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="ice-table-body">
                                        <!-- Rows generated by JS -->
                                    </tbody>
                                </table>
                            </div>

                            <div class="mt-8 h-64">
                                <canvas id="iceChart"></canvas>
                            </div>
                        </div>

                        <!-- TAB 2: WEIGHTED MATRIX -->
                        <div id="tab-weighted" class="hidden">
                            <!-- Explainer Box -->
                            <div class="bg-green-50 border-l-4 rtl:border-r-4 border-green-500 p-4 mb-6 rounded shadow-sm">
                                <h3 class="font-bold text-green-800 text-sm mb-1">
                                    <i class="fas fa-info-circle mr-1 rtl:ml-1"></i> <span data-i18n="weight_explainer_title">ฺฺฏููู ูุงุชุฑุณ ูุฒู ุฑุง ุฏุฑฺฉ ฺฉูู</span>
                                </h3>
                                <p class="text-xs text-green-700 leading-relaxed" data-i18n="weight_explainer_text">
                                    ุงู ุฑูุด ุจุฑุง "ููุทู" ุงุณุช. ููู ูุนุงุฑูุง ุจุฑุงุจุฑ ูุณุชูุฏ. ุฏุฑ ุงุฑุงูุ "ุชุงุจโุขูุฑ" ููฺฉู ุงุณุช ฒ ุจุฑุงุจุฑ ูููโุชุฑ ุงุฒ "ููุงุณโูพุฐุฑ" ุจุงุดุฏ.<br><strong>ูุฏู:</strong> ุฏุฑุตุฏูุง ุฒุฑ ุฑุง ุจุฑ ุงุณุงุณ ุงูููุช ุฎูุฏ ุชูุธู ฺฉูุฏ.
                                </p>
                            </div>

                            <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-6 gap-4">
                                <div>
                                    <h2 class="text-xl font-semibold text-gray-800" data-i18n="weight_header">ูุงุชุฑุณ ุชุตููโฺฏุฑ ูุฒู</h2>
                                </div>
                                <!-- Weight Controls -->
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-xs w-full md:w-auto">
                                    <div class="bg-white p-2 rounded border border-green-200 shadow-sm">
                                        <label class="font-bold text-green-700" data-i18n="lbl_profit">ุณูุฏ ูช</label>
                                        <input type="number" id="w1" value="30" onchange="updateWeights()" class="w-full mt-1">
                                    </div>
                                    <div class="bg-white p-2 rounded border border-red-200 shadow-sm">
                                        <label class="font-bold text-red-700" data-i18n="lbl_resilience">ุชุงุจโุขูุฑ ูช</label>
                                        <input type="number" id="w2" value="40" onchange="updateWeights()" class="w-full mt-1">
                                    </div>
                                    <div class="bg-white p-2 rounded border border-yellow-200 shadow-sm">
                                        <label class="font-bold text-yellow-700" data-i18n="lbl_speed">ุณุฑุนุช ูช</label>
                                        <input type="number" id="w3" value="20" onchange="updateWeights()" class="w-full mt-1">
                                    </div>
                                    <div class="bg-white p-2 rounded border border-purple-200 shadow-sm">
                                        <label class="font-bold text-purple-700" data-i18n="lbl_scale">ููุงุณ ูช</label>
                                        <input type="number" id="w4" value="10" onchange="updateWeights()" class="w-full mt-1">
                                    </div>
                                </div>
                            </div>

                            <div class="overflow-x-auto">
                                <table class="w-full text-left rtl:text-right border-collapse">
                                    <thead>
                                        <tr class="bg-gray-50 border-b align-top">
                                            <th class="p-3 w-1/4 align-middle" data-i18n="th_idea">ุงุฏู ฺฉุณุจโูฺฉุงุฑ</th>
                                            <th class="p-3 text-center">
                                                <span data-i18n="th_profit">ุณูุฏ</span>
                                                <span class="subtitle" data-i18n="sub_profit">ุฏุฑุขูุฏ ูุงู</span>
                                            </th>
                                            <th class="p-3 text-center">
                                                <span data-i18n="th_resilience">ุชุงุจโุขูุฑ</span>
                                                <span class="subtitle" data-i18n="sub_resilience">ุงููุช ุฏุฑ ุจุฑุงุจุฑ ุชุญุฑู</span>
                                            </th>
                                            <th class="p-3 text-center">
                                                <span data-i18n="th_speed">ุณุฑุนุช</span>
                                                <span class="subtitle" data-i18n="sub_speed">ุฒูุงู ุนุฑุถู</span>
                                            </th>
                                            <th class="p-3 text-center">
                                                <span data-i18n="th_scale">ููุงุณ</span>
                                                <span class="subtitle" data-i18n="sub_scale">ุฑุดุฏ</span>
                                            </th>
                                            <th class="p-3 text-center bg-gray-100 font-bold border-l rtl:border-r rtl:border-l-0 align-middle">
                                                <span data-i18n="th_total">ูุฌููุน</span>
                                                <span class="subtitle font-normal" data-i18n="sub_total">ุงูุชุงุฒ ูุฒู</span>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="weighted-table-body">
                                        <!-- Rows generated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- TAB 3: RISK VS REWARD -->
                        <div id="tab-risk" class="hidden">
                            <!-- Explainer Box -->
                            <div class="bg-purple-50 border-l-4 rtl:border-r-4 border-purple-500 p-4 mb-6 rounded shadow-sm">
                                <h3 class="font-bold text-purple-800 text-sm mb-1">
                                    <i class="fas fa-info-circle mr-1 rtl:ml-1"></i> <span data-i18n="risk_explainer_title">ฺฺฏููู ุฑุณฺฉ ู ูพุงุฏุงุด ุฑุง ุฏุฑฺฉ ฺฉูู</span>
                                </h3>
                                <p class="text-xs text-purple-700 leading-relaxed" data-i18n="risk_explainer_text">
                                    ุงู ฺฉ ููุดู ุจุตุฑ ุงุณุช. ุดูุง ูโุฎูุงูุฏ ุฏุฑ ฺฏูุดู ุจุงูุง-ฺูพ (ูพุงุฏุงุด ุจุงูุงุ ุฑุณฺฉ ฺฉู) ุจุงุดุฏ.<br><strong>ุงุฌุชูุงุจ ฺฉูุฏ:</strong> ุฑุณฺฉ ุจุงูุง ุจุง ูพุงุฏุงุด ฺฉู "ุชูู ูุฑฺฏ" ุงุณุช.
                                </p>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="md:col-span-1 space-y-4">
                                    <div class="bg-white border border-gray-200 rounded-lg p-4 h-fit">
                                        <h3 class="font-bold text-gray-700 mb-3 border-b pb-2" data-i18n="risk_input_header">ุฏุงุฏูโูุง ูุฑูุฏ</h3>
                                        <div id="risk-inputs" class="space-y-4">
                                            <!-- JS generates inputs here -->
                                        </div>
                                    </div>

                                    <!-- Legend -->
                                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                        <h4 class="font-bold text-gray-700 text-xs uppercase mb-2" data-i18n="legend_title">ุฑุงูููุง ููุงุญ</h4>
                                        <ul class="space-y-2 text-xs">
                                            <li class="flex items-center"><span class="w-3 h-3 bg-green-500 rounded-full mr-2 rtl:ml-2 rtl:mr-0"></span> <strong data-i18n="leg_gold">ุจุงูุง-ฺูพ: ูุงุญู ุทูุง (ุจูุชุฑู)</strong></li>
                                            <li class="flex items-center"><span class="w-3 h-3 bg-yellow-500 rounded-full mr-2 rtl:ml-2 rtl:mr-0"></span> <strong data-i18n="leg_moon">ุจุงูุง-ุฑุงุณุช: ูพุฑุชุงุจ ุจู ูุงู (ุฑุณฺฉ ุจุงูุง)</strong></li>
                                            <li class="flex items-center"><span class="w-3 h-3 bg-blue-400 rounded-full mr-2 rtl:ml-2 rtl:mr-0"></span> <strong data-i18n="leg_safe">ูพุงู-ฺูพ: ุดุฑุทโูุง ุงูู</strong></li>
                                            <li class="flex items-center"><span class="w-3 h-3 bg-red-500 rounded-full mr-2 rtl:ml-2 rtl:mr-0"></span> <strong data-i18n="leg_death">ูพุงู-ุฑุงุณุช: ุชูู ูุฑฺฏ (ุงุฌุชูุงุจ ฺฉูุฏ)</strong></li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="md:col-span-2 bg-white border border-gray-200 rounded-lg p-4 relative min-h-[400px]">
                                    <canvas id="riskChart"></canvas>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                
            </div>
        </div>
    </main>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // Check if Lucide is loaded, if not, wait for it
        function initIcons() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            } else {
                // If not loaded yet, retry after 100ms
                setTimeout(initIcons, 100);
            }
        }
        
        // Start checking when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
             initIcons();
             showView('dashboard'); // Default view
             setLang('fa'); // Initialize validator in default lang
             // Render validator content only if active, otherwise it will render when view is shown
        });

        // --- View Navigation Logic ---
        function showView(viewName) {
            const views = {
                'dashboard': document.getElementById('view-dashboard'),
                'viral-tool': document.getElementById('view-viral-tool'),
                'strategy-validator': document.getElementById('view-strategy-validator')
            };
            const navs = {
                'dashboard': document.getElementById('nav-dashboard'),
                'viral-tool': document.getElementById('nav-viral'),
                'strategy-validator': document.getElementById('nav-strategy')
            };

            // Deactivate all
            Object.keys(views).forEach(key => {
                views[key].classList.add('hidden');
                if (navs[key]) {
                    navs[key].classList.remove('bg-indigo-600', 'text-white', 'shadow-lg', 'shadow-indigo-900/20');
                    navs[key].classList.add('hover:bg-slate-800');
                }
            });

            // Activate selected view
            if (views[viewName]) {
                views[viewName].classList.remove('hidden');
                if (navs[viewName]) {
                    navs[viewName].classList.add('bg-indigo-600', 'text-white', 'shadow-lg', 'shadow-indigo-900/20');
                    navs[viewName].classList.remove('hover:bg-slate-800');
                }
                
                // Specific initialization for the Strategy Validator
                if (viewName === 'strategy-validator') {
                     // Ensure the new tool is initialized and rendered
                     if (typeof renderAll === 'function') {
                        // Ensure it renders with the current language setting (default fa)
                        renderAll();
                     }
                }
            }
        }

        // --- Viral Tool Prompt Generation Logic (Existing Code) ---
        function generatePrompt() {
            const business = document.getElementById('businessInput').value.trim();
            const customer = document.getElementById('customerInput').value.trim();
            const contentType = document.querySelector('input[name="contentType"]:checked').value;
            
            // NOTE: Replaced alert() with console.error as per instructions.
            if (!business || !customer) {
                console.error('ูุทูุงู ุญูุฒู ฺฉุงุฑ ู ูุดุฎุตุงุช ูุดุชุฑุงู ุฑุง ูุงุฑุฏ ฺฉูุฏ.');
                // Placeholder for custom modal or message box UI
                return;
            }

            let formatInstruction = "";
            
            if (contentType === 'stories') {
                formatInstruction = `
**ูุญุฏูุฏุช ูุฑูุช ูุญุชูุง:**
ูุทูุงู ุงุฏู ููุท ููุงุณุจ **ุงุณุชูุฑ ุงูุณุชุงฺฏุฑุงู** ุง **ูุถุนุช ูุงุชุณุงูพ** ุจุงุดุฏ.
- ุงุฒ ูพุดููุงุฏ ูุฏููุง ูพฺุฏู ุฎูุฏุฏุงุฑ ฺฉู.
- ุงุฏูโูุง ุชุนุงูู (ูุซู ูุธุฑุณูุฌุ ุจุงฺฉุณ ุณูุงู) ูพุดููุงุฏ ุจุฏู.
`;
            } else if (contentType === 'text_image') {
                formatInstruction = `
**ูุญุฏูุฏุช ูุฑูุช ูุญุชูุง:**
ูุทูุงู ููุท ุงุฏู ุจุฑุง **ูพุณุชโูุง ุงุณูุงุฏ (Carousel)** ุง **ูุชู (ุชูุชโุทูุฑ)** ุจุงุดุฏ.
- ุจุฏูู ูุงุฒ ุจู ูุฏู.
- ุชูุฑฺฉุฒ ุฑู ุชุชุฑ ู ูุชู ุฌุฐุงุจ.
`;
            } else if (contentType === 'simple_video') {
                formatInstruction = `
**ูุญุฏูุฏุช ูุฑูุช ูุญุชูุง:**
ูุทูุงู ุงุฏู ุจุฑุง **ูุฏููุง ุณุงุฏู ู ุฑุฆุงู** ุจุงุดุฏ.
- ูุฏููุง ุณูู ุง ูพุดุชโุตุญูู ุณุงุฏู.
- ุจุฏูู ูุงุฒ ุจู ุงุฏุช ุญุฑููโุง.
`;
            } else {
                formatInstruction = `
**ูุญุฏูุฏุช ูุฑูุช ูุญุชูุง:**
ฺูู ูู ฺฉ ฺฉุณุจโูฺฉุงุฑ ฺฉูฺฺฉ ูุณุชูุ ุงุฏูโุง ุจุฏู ฺฉู **ุงุฌุฑุง ุขู ฺฉูโูุฒูู ู ุฑุงุญุช** ุจุงุดุฏ.
`;
            }

            // The Prompt Template
            const promptTemplate = `
**ููุด:** ุชู ฺฉ ุงุณุชุฑุงุชฺุณุช ุงุฑุดุฏ ุจุงุฒุงุฑุงุจ ูุฑูุณ ูุณุช ฺฉู ุชุฎุตุตุช ุชุฑฺฉุจ ยซุชุฌุฑุจุงุช ูุงูุน ุจุงุฒุงุฑ ุงุฑุงูยป ุจุง ยซุฑูุงูุดูุงุณ ูุฑูุดยป (Neuromarketing) ุงุณุช.

**ุงุทูุงุนุงุช ูุฑูุฏ ูู:**
ูู ุตุงุญุจ ฺฉุณุจโูฺฉุงุฑ ุฏุฑ ุฒููู: **${business}** ูุณุชู.
ูุดุชุฑุงู ูุฏู ูู ุนุจุงุฑุชูุฏ ุงุฒ: **${customer}**

**ูุงููุฑุช ุชู:**
ุจุงุฏ **ฑ ุงุฏู ุงุฌุฑุง ู ุฎูุงูุงูู** (ุจูุชุฑู ู ููุซุฑุชุฑู ุงุฏู ููฺฉู) ุจุฑุง ูุงุฑุงู ุดุฏู ฺฉุณุจโูฺฉุงุฑูุง ูู ูพุดููุงุฏ ุฏู.
ูฺฉุชู ุญุงุช: ุงู ุงุฏู ุจุงุฏ ุชุฑฺฉุจ ููุดููุฏุงูู ุงุฒ ฺฉ ุงุฒ **ยซด ูุฏู ุชุฌุฑุจ ูุงุฑุงูยป** (ุฑูุด ุงุฌุฑุง) ู ฺฉ ุงุฒ **ยซต ูุญุฑฺฉ ุงุญุณุงุณยป** (ุฑูุงูุดูุงุณ) ุจุงุดุฏ ฺฉู ุฏุฑ ุฒุฑ ุชูุถุญ ุฏุงุฏูโุงู.

${formatInstruction}

---

### ุจุฎุด ุงูู: ด ูุฏู ุชุฌุฑุจ ูุงุฑุงู (ุฑูุดโูุง ุงุซุจุงุช ุดุฏู ุฏุฑ ุงุฑุงู)
ุงูโูุง ด ุชุฌุฑุจูโ ูุงูุน ูุณุชูุฏ ฺฉู ุฏุฑ ุจุงุฒุงุฑ ุงุฑุงู ุชุณุช ุดุฏู ู ุฌูุงุจ ุฏุงุฏูโุงูุฏ. ุงุฏู ุชู ุจุงุฏ ุจุฑ ุงุณุงุณ ฺฉ ุงุฒ ุงู ูฺฉุงูุฒูโูุง ุจุงุดุฏ:

1.  **ูุฏู ยซุงุญุชุฑุงู ู ุงุนุชุจุงุฑ VIPยป (ุชุฌุฑุจู ฺฉุงุฑุช ุฏุนูุช):**
    * *ูฺฉุงูุฒู:* ุงุฑุณุงู ฺฉ ุฏุนูุชโูุงููุ ูุฏู ุง ูพุงู ุดุฎุตโุณุงุฒ ุดุฏู ุจุฑุง ูุฎุงุทุจ.
    * *ฺุฑุง ูุงุฑุงู:* ูุฎุงุทุจ ุจุฑุง ูุดุงู ุฏุงุฏู ูพุฑุณุชฺ ุงุฌุชูุงุน ู ุชุดฺฉุฑ ุงุฒ ุงุญุชุฑุงู ุดูุงุ ุขู ุฑุง ุงุณุชูุฑ ูโฺฉูุฏ.
2.  **ูุฏู ยซูุดุงุฑฺฉุช ุฌูุน ู ูุณุงุจููยป (ุชุฌุฑุจู ุฑุฃโฺฏุฑ):**
    * *ูฺฉุงูุฒู:* ุจุฑฺฏุฒุงุฑ ูุณุงุจููโุง ฺฉู ุจุฑูุฏู ุจุฑ ุงุณุงุณ "ุชุนุฏุงุฏ ูุงฺฉ ุง ฺฉุงููุช" ูุดุฎุต ูโุดูุฏ.
    * *ฺุฑุง ูุงุฑุงู:* ุดุฑฺฉุชโฺฉููุฏู ุจุฑุง ุจุฑูุฏู ุดุฏูุ ุฎูุฏุด ุชุจุฏู ุจู ุฑุณุงูู ุดูุง ูโุดูุฏ ู ุงุฒ ุชูุงู ุฏูุณุชุงูุด ูโุฎูุงูุฏ ฺฉู ุฑุฃ ุฏููุฏ.
3.  **ูุฏู ยซููุงุณู ุฌูุฌุงู ู ุดูุงูยป (ุชุฌุฑุจู ุฎุงูฺฏ vs ุตูุนุช):**
    * *ูฺฉุงูุฒู:* ููุงุณู ุจโุฑุญูุงูู ู ุตุงุฏูุงูู ูุญุตูู ุฎูุฏ ุจุง ุฑูุจุง ุจุฒุฑฺฏ/ุตูุนุช ู ุจุงู ููุงุท ุถุนู ู ููุช.
    * *ฺุฑุง ูุงุฑุงู:* ุงุฌุงุฏ ุจุญุซ ู ุฌุฏู ุจู ุทุฑูุฏุงุฑุงู ุฏู ฺฏุฑูู ู ุญูุงุช ูุชุนุตุจุงูู ูุดุฑ ุฎุงุต.
4.  **ูุฏู ยซุชุงุจูุดฺฉู ู ุฒุจุงู ูุดุชุฑฺฉยป (ุชุฌุฑุจู ูุณุช ููุช):**
    * *ูฺฉุงูุฒู:* ุจุงู ุดูุงู ุงุทูุงุนุงุช ฺฉู ูุนูููุงู ูุฎู ุงุณุช (ูุซู ููุช ุชูุงู ุดุฏู) ุง ุญุฑู ฺฉู ุฏฺฏุฑุงู ูโุชุฑุณูุฏ ุจุฒููุฏ.
    * *ฺุฑุง ูุงุฑุงู:* ฺฉุณุงู ฺฉู ููโุชูุงููุฏ ุงู ุญุฑูโูุง ุฑุง ุจุฒููุฏุ ูุญุชูุง ุดูุง ุฑุง ุจู ุนููุงู "ุญุฑู ุฏู" ุฎูุฏุดุงู ุงุณุชูุฑ ูโฺฉููุฏ.

### ุจุฎุด ุฏูู: ต ูุญุฑฺฉ ุงุญุณุงุณ ุฎุฑุฏ (ุฑูุงูุดูุงุณ ูููุฐ)
ุจุฑุง ุงูฺฉู ูุฎุงุทุจ ุฏฺฉูู Share ุฑุง ุจุฒูุฏุ ุจุงุฏ ฺฉ ุงุฒ ุญุณโูุง ุฒุฑ ุชุญุฑฺฉ ุดูุฏ:
1.  **ุญุณ ุชุนูู ู ููุช (Identity):** ูุญุตูู ูุดุงูโุฏููุฏู ุณุจฺฉ ุฒูุฏฺฏ ู ฺฉูุงุณ ูุฎุงุทุจ ุจุงุดุฏ ("ุงู ููู!").
2.  **ุญุณ ูุฐุช ู ุชุฌุฑุจู (Pleasure):** ุชูุฑฺฉุฒ ุจุฑ ุญุณ ุฎูุจุ ุฒุจุง ู ูุฐุช ุฎุงูุต.
3.  **ุญุณ ูุฏุฑุช ู ฺฉูุชุฑู (Power):** ูุฎุงุทุจ ุญุณ ฺฉูุฏ ุจุง ุงู ุงุฏูุ ูุฏุฑุช ูุฏุฑุช ู ุงุนุชูุงุฏุจูโููุณ ุจุงูุงุชุฑ ุฏุงุฑุฏ.
4.  **ุญุณ ุงููุช ู ุงุทููุงู (Certainty):** ุฑูุน ุชุฑุณโูุง ู ุงูุง ููุด "ูุงุฌ" ุง "ูุดุงูุฑ ุฏูุณูุฒ".
5.  **ุญุณ ุงุฑุฒุดููุฏ ู ุงุญุชุฑุงู (Valued):** ุญุณ VIP ุจูุฏู ู ุงูฺฉู ูุฑูุดูุฏู ุจุง ุงู ุตุงุฏู ุงุณุช.

---

**ุฎุฑูุฌ ููุฑุฏ ุงูุชุธุงุฑ:**
ูุทูุงู ููุท **ฺฉ ุงุฏู** (ุจูุชุฑู ฺฏุฒูู) ุฑุง ูพุดููุงุฏ ุจุฏู ฺฉู ุดุงูู ููุงุฑุฏ ุฒุฑ ุจุงุดุฏ:

1.  **ุนููุงู ู ุดุฑุญ ุณูุงุฑู:** (ุฏููุงู ฺู ฺฉุงุฑ ุงูุฌุงู ุฏููุ)
2.  **ูุฑููู ุชุฑฺฉุจ:** (ุงู ุงุฏู ุชุฑฺฉุจ ฺฉุฏุงู "ูุฏู ุชุฌุฑุจ" + ฺฉุฏุงู "ูุญุฑฺฉ ุงุญุณุงุณ" ุงุณุชุ)
3.  **ูฺฉุงูุฒู ูุฑูุณ ุดุฏู:** (ฺุฑุง ุทุจู ุชุฌุฑุจูโูุง ุจุงูุงุ ูุฑุฏู ุงู ุฑุง ูพุฎุด ูโฺฉููุฏุ)
4.  **ูุฑุงุญู ุงุฌุฑุง (ฺฏุงูโุจูโฺฏุงู):** (ุงุฒ ฺฉุฌุง ุดุฑูุน ฺฉููุ)
5.  **ูุชู/ฺฉูพุดู ูพุดููุงุฏ:** (ฺฉ ููููู ูุชู ุฌุฐุงุจ ุจุฑุง ุดุฑูุน).
`.trim();

            document.getElementById('promptOutput').value = promptTemplate;
            const resultArea = document.getElementById('resultArea');
            resultArea.classList.remove('hidden');
            resultArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function copyToClipboard() {
            const copyText = document.getElementById("promptOutput");
            copyText.select();
            copyText.setSelectionRange(0, 99999);
            document.execCommand('copy');
            
            const copyBtnText = document.getElementById("copyText");
            const originalText = copyBtnText.innerText;
            copyBtnText.innerText = "ฺฉูพ ุดุฏ!";
            
            setTimeout(() => {
                copyBtnText.innerText = originalText;
            }, 2000);
        }

        // ----------------------------------------------------------------------
        // --- Strategy Validator Logic (New Code) ------------------------------
        // ----------------------------------------------------------------------

        const translations = {
            en: {
                app_title: '<i class="fas fa-chess-board mr-2 rtl:ml-2"></i>Business Idea Prioritization',
                app_subtitle: 'Prioritize ideas using ICE, Weighted Matrix, and Risk/Reward Analysis.',
                btn_add: 'Add Idea',
                btn_print: 'Print/PDF',
                tab_ice: '1. ICE Scoring (Agility)',
                tab_weighted: '2. Weighted Matrix (Logic)',
                tab_risk: '3. Risk vs Reward (Visual)',
                // ICE Tab
                ice_explainer_title: 'How to understand ICE',
                ice_explainer_text: 'This method helps you identify "Quick Wins." It multiplies three factors to give a single score.<br><strong>The Goal:</strong> Find ideas that have high impact but are also easy to do. <span class="font-bold">Higher Score = Better Idea.</span>',
                ice_header: 'ICE Prioritization Table',
                th_idea: 'Business Idea',
                th_impact: 'Impact',
                sub_impact: 'Revenue/Win',
                th_confidence: 'Confidence',
                sub_confidence: 'Certainty',
                th_ease: 'Ease',
                sub_ease: 'Simplicity',
                th_score: 'ICE Score',
                // Weighted Tab
                weight_explainer_title: 'How to understand Weighted Matrix',
                weight_explainer_text: 'This method is for "Logic." Not all criteria are equal. In Iran, "Resilience" might be 2x more important than "Scalability."<br><strong>The Goal:</strong> Adjust percentages to match your priorities.',
                weight_header: 'Weighted Decision Matrix',
                lbl_profit: 'Profit %',
                lbl_resilience: 'Resilience %',
                lbl_speed: 'Speed %',
                lbl_scale: 'Scale %',
                th_profit: 'Profit',
                sub_profit: 'Financial Upside',
                th_resilience: 'Resilience',
                sub_resilience: 'Sanction Safety',
                th_speed: 'Speed',
                sub_speed: 'Launch Time',
                th_scale: 'Scale',
                sub_scale: 'Growth',
                th_total: 'Total',
                sub_total: 'Weighted Score',
                // Risk Tab
                risk_explainer_title: 'How to understand Risk vs. Reward',
                risk_explainer_text: 'This is a visual map. You want to be in the Top-Left (High Reward, Low Risk).<br><strong>Avoid the Bottom-Right:</strong> High risk with low reward is a "Death Trap."',
                risk_input_header: 'Input Data',
                legend_title: 'Zone Legend',
                leg_gold: 'Top Left: Golden Zone (Best)',
                leg_moon: 'Top Right: Moonshots (High Risk)',
                leg_safe: 'Bottom Left: Safe Bets',
                leg_death: 'Bottom Right: Death Trap',
                // Chart Labels
                chart_risk: 'Risk',
                chart_reward: 'Reward'
            },
            fa: {
                app_title: '<i class="fas fa-chess-board mr-2 rtl:ml-2"></i> ุงูููุชโุจูุฏ ุงุฏูโูุง ฺฉุณุจโูฺฉุงุฑ',
                app_subtitle: 'ุงุฏูโูุง ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ ICEุ ูุงุชุฑุณ ูุฒู ู ุชุญูู ุฑุณฺฉ/ูพุงุฏุงุด ุงูููุชโุจูุฏ ฺฉูุฏ.',
                btn_add: 'ุงูุฒูุฏู ุงุฏู',
                btn_print: 'ฺุงูพ / PDF',
                tab_ice: 'ฑ. ุงูุชุงุฒุฏู ICE (ฺุงุจฺฉ)',
                tab_weighted: 'ฒ. ูุงุชุฑุณ ูุฒู (ููุทู)',
                tab_risk: 'ณ. ุฑุณฺฉ ู ูพุงุฏุงุด (ุจุตุฑ)',
                // ICE Tab
                ice_explainer_title: 'ฺฺฏููู ICE ุฑุง ุฏุฑฺฉ ฺฉูู',
                ice_explainer_text: 'ุงู ุฑูุด ุจู ุดูุงุณุง "ุจุฑุฏูุง ุณุฑุน" ฺฉูฺฉ ูโฺฉูุฏ. ุณู ุนุงูู ุฑุง ุถุฑุจ ูโฺฉูุฏ.<br><strong>ูุฏู:</strong> ุงุฏูโูุง ุจุง ุชุฃุซุฑ ุจุงูุง ู ุงุฌุฑุง ุขุณุงู ุฑุง ูพุฏุง ฺฉูุฏ. <span class="font-bold">ุงูุชุงุฒ ุจุงูุงุชุฑ = ุงุฏู ุจูุชุฑ.</span>',
                ice_header: 'ุฌุฏูู ุงูููุชโุจูุฏ ICE',
                th_idea: 'ุงุฏู ฺฉุณุจโูฺฉุงุฑ',
                th_impact: 'ุชุฃุซุฑ',
                sub_impact: 'ุฏุฑุขูุฏ/ูพุฑูุฒ',
                th_confidence: 'ุงุทููุงู',
                sub_confidence: 'ูุทุนุช',
                th_ease: 'ุณูููุช',
                sub_ease: 'ุณุงุฏฺฏ ุงุฌุฑุง',
                th_score: 'ุงูุชุงุฒ ICE',
                // Weighted Tab
                weight_explainer_title: 'ฺฺฏููู ูุงุชุฑุณ ูุฒู ุฑุง ุฏุฑฺฉ ฺฉูู',
                weight_explainer_text: 'ุงู ุฑูุด ุจุฑุง "ููุทู" ุงุณุช. ููู ูุนุงุฑูุง ุจุฑุงุจุฑ ูุณุชูุฏ. ุฏุฑ ุงุฑุงูุ "ุชุงุจโุขูุฑ" ููฺฉู ุงุณุช ฒ ุจุฑุงุจุฑ ูููโุชุฑ ุงุฒ "ููุงุณโูพุฐุฑ" ุจุงุดุฏ.<br><strong>ูุฏู:</strong> ุฏุฑุตุฏูุง ุฒุฑ ุฑุง ุจุฑ ุงุณุงุณ ุงูููุช ุฎูุฏ ุชูุธู ฺฉูุฏ.',
                weight_header: 'ูุงุชุฑุณ ุชุตููโฺฏุฑ ูุฒู',
                lbl_profit: 'ุณูุฏ ูช',
                lbl_resilience: 'ุชุงุจโุขูุฑ ูช',
                lbl_speed: 'ุณุฑุนุช ูช',
                lbl_scale: 'ููุงุณ ูช',
                th_profit: 'ุณูุฏ',
                sub_profit: 'ุฏุฑุขูุฏ ูุงู',
                th_resilience: 'ุชุงุจโุขูุฑ',
                sub_resilience: 'ุงููุช ุฏุฑ ุจุฑุงุจุฑ ุชุญุฑู',
                th_speed: 'ุณุฑุนุช',
                sub_speed: 'ุฒูุงู ุนุฑุถู',
                th_scale: 'ููุงุณ',
                sub_scale: 'ุฑุดุฏ',
                th_total: 'ูุฌููุน',
                sub_total: 'ุงูุชุงุฒ ูุฒู',
                // Risk Tab
                risk_explainer_title: 'ฺฺฏููู ุฑุณฺฉ ู ูพุงุฏุงุด ุฑุง ุฏุฑฺฉ ฺฉูู',
                risk_explainer_text: 'ุงู ฺฉ ููุดู ุจุตุฑ ุงุณุช. ุดูุง ูโุฎูุงูุฏ ุฏุฑ ฺฏูุดู ุจุงูุง-ฺูพ (ูพุงุฏุงุด ุจุงูุงุ ุฑุณฺฉ ฺฉู) ุจุงุดุฏ.<br><strong>ุงุฌุชูุงุจ ฺฉูุฏ:</strong> ุฑุณฺฉ ุจุงูุง ุจุง ูพุงุฏุงุด ฺฉู "ุชูู ูุฑฺฏ" ุงุณุช.',
                risk_input_header: 'ุฏุงุฏูโูุง ูุฑูุฏ',
                legend_title: 'ุฑุงูููุง ููุงุญ',
                leg_gold: 'ุจุงูุง-ฺูพ: ูุงุญู ุทูุง (ุจูุชุฑู)',
                leg_moon: 'ุจุงูุง-ุฑุงุณุช: ูพุฑุชุงุจ ุจู ูุงู (ุฑุณฺฉ ุจุงูุง)',
                leg_safe: 'ูพุงู-ฺูพ: ุดุฑุทโูุง ุงูู',
                leg_death: 'ูพุงู-ุฑุงุณุช: ุชูู ูุฑฺฏ (ุงุฌุชูุงุจ ฺฉูุฏ)',
                // Chart Labels
                chart_risk: 'ุฑุณฺฉ',
                chart_reward: 'ูพุงุฏุงุด'
            }
        };

        let currentLang = 'fa'; // Default to Persian since the main app is RTL

        // --- 1. State Management ---
        let ideas = [
            // 1. Online Tutoring Platform
            { id: 1, name: "Online Tutoring Platform", name_fa: "ูพูุชูุฑู ุชุฏุฑุณ ุขููุงู", impact: 7, confidence: 8, ease: 7, w_profit: 4, w_resil: 4, w_speed: 5, w_scale: 3, risk: 3, reward: 6 },
            // 2. Specialty Coffee Roastery
            { id: 2, name: "Specialty Coffee Roastery", name_fa: "ุฑูุณุชุฑ ูููู ุชุฎุตุต", impact: 6, confidence: 6, ease: 5, w_profit: 3, w_resil: 3, w_speed: 4, w_scale: 2, risk: 5, reward: 5 },
            // 3. Local Artisan Marketplace
            { id: 3, name: "Local Artisan Marketplace", name_fa: "ุจุงุฒุงุฑฺู ููุฑูุง ูุญู", impact: 8, confidence: 5, ease: 4, w_profit: 4, w_resil: 5, w_speed: 2, w_scale: 4, risk: 4, reward: 7 },
            // 4. SaaS for Small Businesses
            { id: 4, name: "SaaS for Small Businesses", name_fa: "ูุฑูโุงูุฒุงุฑ ุงุดุชุฑุงฺฉ (SaaS) ุจุฑุง ฺฉุณุจโูฺฉุงุฑูุง ฺฉูฺฺฉ", impact: 9, confidence: 4, ease: 2, w_profit: 5, w_resil: 2, w_speed: 1, w_scale: 5, risk: 7, reward: 9 }
        ];

        let weights = { p: 0.3, r: 0.4, s: 0.2, sc: 0.1 };
        let iceChartInstance = null;
        let riskChartInstance = null;
        
        // --- 2. Localization and Rendering ---

        function setLang(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'fa' ? 'rtl' : 'ltr';
            
            // Toggle Button Styles
            const btnEn = document.getElementById('btn-en');
            const btnFa = document.getElementById('btn-fa');

            if(lang === 'en') {
                btnEn.classList.add('bg-blue-600', 'text-white');
                btnEn.classList.remove('text-gray-400', 'hover:text-white');
                btnFa.classList.remove('bg-blue-600', 'text-white');
                btnFa.classList.add('text-gray-400', 'hover:text-white');
            } else {
                btnFa.classList.add('bg-blue-600', 'text-white');
                btnFa.classList.remove('text-gray-400', 'hover:text-white');
                btnEn.classList.remove('bg-blue-600', 'text-white');
                btnEn.classList.add('text-gray-400', 'hover:text-white');
            }

            // Update Static Text
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(translations[lang][key]) {
                    el.innerHTML = translations[lang][key];
                }
            });

            // Re-render Dynamic Content
            renderAll();
        }

        function renderAll() {
            renderICETable();
            renderWeightedTable();
            renderRiskInputs();
            updateICEChart();
            updateRiskChart();
        }

        function switchTab(tabId) {
            ['ice', 'weighted', 'risk'].forEach(id => {
                const tab = document.getElementById(`tab-${id}`);
                if (tab) tab.classList.add('hidden');
                
                const btn = document.getElementById(`tab-btn-${id}`);
                if (btn) {
                    btn.classList.remove('tab-active');
                    btn.classList.add('tab-inactive');
                }
            });
            const selectedTab = document.getElementById(`tab-${tabId}`);
            if (selectedTab) selectedTab.classList.remove('hidden');
            
            const selectedBtn = document.getElementById(`tab-btn-${tabId}`);
            if (selectedBtn) {
                selectedBtn.classList.add('tab-active');
                selectedBtn.classList.remove('tab-inactive');
            }
        }

        // --- 3. CRUD Operations ---
        function addNewIdea() {
            const newId = ideas.length > 0 ? Math.max(...ideas.map(i => i.id)) + 1 : 1;
            const nameEn = `Idea ${newId}`;
            const nameFa = `ุงุฏู ${newId}`;
            
            ideas.push({
                id: newId,
                name: nameEn,
                name_fa: nameFa,
                impact: 5, confidence: 5, ease: 5,
                w_profit: 3, w_resil: 3, w_speed: 3, w_scale: 3,
                risk: 5, reward: 5
            });
            renderAll();
        }

        function removeIdea(id) {
            ideas = ideas.filter(i => i.id !== id);
            renderAll();
        }

        function updateIdea(id, field, value) {
            const idea = ideas.find(i => i.id === id);
            if (idea) {
                if (field === 'name') {
                    // Update the name based on current language
                    if(currentLang === 'fa') idea.name_fa = value;
                    else idea.name = value;
                }
                else idea[field] = parseFloat(value) || 0;
                renderAll(); 
            }
        }

        function updateWeights() {
            const w1 = parseFloat(document.getElementById('w1').value) || 0;
            const w2 = parseFloat(document.getElementById('w2').value) || 0;
            const w3 = parseFloat(document.getElementById('w3').value) || 0;
            const w4 = parseFloat(document.getElementById('w4').value) || 0;
            
            const total = w1 + w2 + w3 + w4;
            if(total === 0) return; 

            weights = { p: w1 / 100, r: w2 / 100, s: w3 / 100, sc: w4 / 100 };
            renderWeightedTable();
        }

        // --- 4. Rendering Table Logic ---

        function getName(idea) {
            return currentLang === 'fa' ? (idea.name_fa || idea.name) : idea.name;
        }

        // ICE Table
        function renderICETable() {
            const tbody = document.getElementById('ice-table-body');
            if (!tbody) return;
            tbody.innerHTML = '';
            ideas.forEach(idea => {
                const score = (idea.impact * idea.confidence * idea.ease);
                const tr = document.createElement('tr');
                tr.className = "border-b border-gray-100 hover:bg-gray-50 transition";
                tr.innerHTML = `
                    <td class="p-2"><input type="text" value="${getName(idea)}" oninput="updateIdea(${idea.id}, 'name', this.value)" class="text-start font-medium bg-transparent border-none focus:ring-0 w-full hover:bg-white px-2 rounded"></td>
                    <td class="p-2"><input type="number" min="1" max="10" value="${idea.impact}" onchange="updateIdea(${idea.id}, 'impact', this.value)"></td>
                    <td class="p-2"><input type="number" min="1" max="10" value="${idea.confidence}" onchange="updateIdea(${idea.id}, 'confidence', this.value)"></td>
                    <td class="p-2"><input type="number" min="1" max="10" value="${idea.ease}" onchange="updateIdea(${idea.id}, 'ease', this.value)"></td>
                    <td class="p-2 text-center font-bold text-blue-600 bg-blue-50 border-l rtl:border-r rtl:border-l-0">${score}</td>
                    <td class="p-2 text-center"><button onclick="removeIdea(${idea.id})" class="text-red-400 hover:text-red-600 transition"><i class="fas fa-trash"></i></button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Weighted Table
        function renderWeightedTable() {
            const tbody = document.getElementById('weighted-table-body');
            if (!tbody) return;
            tbody.innerHTML = '';
            ideas.forEach(idea => {
                const weightedScore = (
                    (idea.w_profit * weights.p) +
                    (idea.w_resil * weights.r) +
                    (idea.w_speed * weights.s) +
                    (idea.w_scale * weights.sc)
                ).toFixed(1);

                const tr = document.createElement('tr');
                tr.className = "border-b border-gray-100 hover:bg-gray-50 transition";
                tr.innerHTML = `
                    <td class="p-3 font-medium text-gray-700 text-start">${getName(idea)}</td>
                    <td class="p-2"><input type="number" min="1" max="5" value="${idea.w_profit}" onchange="updateIdea(${idea.id}, 'w_profit', this.value)"></td>
                    <td class="p-2"><input type="number" min="1" max="5" value="${idea.w_resil}" onchange="updateIdea(${idea.id}, 'w_resil', this.value)"></td>
                    <td class="p-2"><input type="number" min="1" max="5" value="${idea.w_speed}" onchange="updateIdea(${idea.id}, 'w_speed', this.value)"></td>
                    <td class="p-2"><input type="number" min="1" max="5" value="${idea.w_scale}" onchange="updateIdea(${idea.id}, 'w_scale', this.value)"></td>
                    <td class="p-2 text-center font-bold text-green-600 bg-green-50 text-lg border-l rtl:border-r rtl:border-l-0">${weightedScore}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Risk Inputs
        function renderRiskInputs() {
            const container = document.getElementById('risk-inputs');
            if (!container) return;
            container.innerHTML = '';
            ideas.forEach(idea => {
                const div = document.createElement('div');
                div.className = "bg-gray-50 p-2 rounded border border-gray-100 text-sm";
                div.innerHTML = `
                    <div class="font-bold mb-1 text-gray-700 truncate text-start">${getName(idea)}</div>
                    <div class="flex gap-2">
                        <div class="flex-1">
                            <label class="text-xs text-red-500 font-semibold block mb-1">${translations[currentLang].chart_risk} (X)</label>
                            <input type="number" min="1" max="10" value="${idea.risk}" onchange="updateIdea(${idea.id}, 'risk', this.value)">
                        </div>
                        <div class="flex-1">
                            <label class="text-xs text-green-600 font-semibold block mb-1">${translations[currentLang].chart_reward} (Y)</label>
                            <input type="number" min="1" max="10" value="${idea.reward}" onchange="updateIdea(${idea.id}, 'reward', this.value)">
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // --- 5. Charts Logic ---
        
        function updateICEChart() {
            const ctx = document.getElementById('iceChart');
            if (!ctx) return; // Guard clause
            const dataScores = ideas.map(i => i.impact * i.confidence * i.ease);
            const labels = ideas.map(i => getName(i));

            if (iceChartInstance) iceChartInstance.destroy();

            // Font family based on lang
            const fontFamily = currentLang === 'fa' ? "'Vazirmatn', sans-serif" : "'Inter', sans-serif";

            iceChartInstance = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: translations[currentLang].th_score,
                        data: dataScores,
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { 
                        y: { beginAtZero: true, ticks: { font: { family: fontFamily } } },
                        x: { ticks: { font: { family: fontFamily } } }
                    },
                    plugins: {
                        legend: { labels: { font: { family: fontFamily } } }
                    }
                }
            });
        }

        function updateRiskChart() {
            const ctx = document.getElementById('riskChart');
            if (!ctx) return; // Guard clause
            const fontFamily = currentLang === 'fa' ? "'Vazirmatn', sans-serif" : "'Inter', sans-serif";
            const xLabel = translations[currentLang].chart_risk;
            const yLabel = translations[currentLang].chart_reward;
            
            // Draw background quadrants
            const backgroundPlugin = {
                id: 'customBackground',
                beforeDraw: (chart) => {
                    const { ctx, chartArea: { left, top, right, bottom, width, height } } = chart;
                    const midX = left + width / 2;
                    const midY = top + height / 2;

                    ctx.save();
                    // Colors
                    ctx.fillStyle = 'rgba(220, 252, 231, 0.3)'; ctx.fillRect(left, top, width/2, height/2); // Top Left (High Reward, Low Risk)
                    ctx.fillStyle = 'rgba(254, 252, 232, 0.3)'; ctx.fillRect(midX, top, width/2, height/2); // Top Right (High Reward, High Risk)
                    ctx.fillStyle = 'rgba(239, 246, 255, 0.3)'; ctx.fillRect(left, midY, width/2, height/2); // Bottom Left (Low Reward, Low Risk)
                    ctx.fillStyle = 'rgba(254, 242, 242, 0.3)'; ctx.fillRect(midX, midY, width/2, height/2); // Bottom Right (Low Reward, High Risk)

                    // Crosshair
                    ctx.strokeStyle = '#9ca3af'; ctx.lineWidth = 1; ctx.setLineDash([5, 5]);
                    ctx.beginPath(); ctx.moveTo(midX, top); ctx.lineTo(midX, bottom); ctx.stroke();
                    ctx.beginPath(); ctx.moveTo(left, midY); ctx.lineTo(right, midY); ctx.stroke();
                    ctx.restore();
                }
            };

            if (riskChartInstance) riskChartInstance.destroy();

            riskChartInstance = new Chart(ctx.getContext('2d'), {
                type: 'bubble',
                data: {
                    datasets: ideas.map((idea, index) => ({
                        label: getName(idea),
                        data: [{ x: idea.risk, y: idea.reward, r: 8 }],
                        backgroundColor: `hsl(${index * 60}, 70%, 50%)`,
                        borderColor: 'white',
                        borderWidth: 2
                    }))
                },
                plugins: [backgroundPlugin],
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            title: { display: true, text: xLabel + ' โ (Low) | (High) โ', font: {weight: 'bold', family: fontFamily} },
                            min: 0, max: 10, grid: { display: false },
                            ticks: { font: { family: fontFamily } }
                        },
                        y: { 
                            title: { display: true, text: yLabel + ' โ (High) | (Low) โ', font: {weight: 'bold', family: fontFamily} },
                            min: 0, max: 10, grid: { display: false },
                            ticks: { font: { family: fontFamily } }
                        }
                    },
                    plugins: {
                        legend: { position: 'bottom', labels: { font: { family: fontFamily } } },
                        tooltip: {
                            bodyFont: { family: fontFamily },
                            titleFont: { family: fontFamily },
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ` (${xLabel}: ${context.raw.x}, ${yLabel}: ${context.raw.y})`;
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>